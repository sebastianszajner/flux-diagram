<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FLUX â€” Interaktywna Mapa Kompetencji | Nowe Motywacje</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: { extend: { colors: {
    flux: { fast: '#f59e0b', liquid: '#06b6d4', unlearn: '#10b981', experiment: '#8b5cf6' },
    dark: { 950: '#0c0f1a', 900: '#111827', 800: '#1e293b', 700: '#334155' }
  }}}
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{font-family:'Inter',system-ui,sans-serif;box-sizing:border-box}
body{background:#0c0f1a;margin:0}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:#111827}::-webkit-scrollbar-thumb{background:#334155;border-radius:3px}

/* Diagram */
.flux-quadrant{cursor:pointer;transition:all .4s cubic-bezier(.4,0,.2,1)}
.flux-quadrant:hover{filter:brightness(1.4);transform:scale(1.03)}
.flux-quadrant:hover .qf{opacity:.35}
.qf{transition:opacity .4s}
.center-pulse{animation:cpulse 3s ease-in-out infinite}
@keyframes cpulse{0%,100%{opacity:.15;transform:scale(1)}50%{opacity:.3;transform:scale(1.05)}}

/* Nav */
.nav-link{position:relative;transition:color .3s}
.nav-link::after{content:'';position:absolute;bottom:-2px;left:0;width:0;height:2px;background:#f59e0b;transition:width .3s}
.nav-link:hover::after,.nav-link.active::after{width:100%}

/* Views */
.view{display:none;opacity:0;transition:opacity .3s}
.view.active{display:block;opacity:1}

/* Cards */
.fcard{transition:all .3s;border:1px solid #1e293b}
.fcard:hover{transform:translateY(-3px);box-shadow:0 8px 30px -10px var(--glow,transparent)}

/* Filters */
.chip{transition:all .2s;cursor:pointer;user-select:none;white-space:nowrap}
.chip:hover{transform:scale(1.03)}
.chip.on{ring:2px;box-shadow:0 0 0 2px var(--ring,#f59e0b)}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.fade-up{animation:fadeUp .4s ease forwards}

/* Tab */
.tab-btn{transition:all .3s;border-bottom:2px solid transparent}
.tab-btn.active{border-bottom-color:currentColor}
.tab-content{display:none}.tab-content.active{display:block;animation:fadeUp .3s ease}

/* Hamburger */
.hamburger span{display:block;width:20px;height:2px;background:#94a3b8;margin:4px 0;transition:all .3s}
.hamburger.open span:nth-child(1){transform:rotate(45deg) translate(4px,4px)}
.hamburger.open span:nth-child(2){opacity:0}
.hamburger.open span:nth-child(3){transform:rotate(-45deg) translate(4px,-4px)}
.mobile-menu{max-height:0;overflow:hidden;transition:max-height .3s}
.mobile-menu.open{max-height:300px}

/* Chat widget */
.chat-toggle{position:fixed;bottom:24px;right:24px;width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#f59e0b,#8b5cf6);cursor:pointer;z-index:9999;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(139,92,246,.4);transition:transform .3s}
.chat-toggle:hover{transform:scale(1.1)}
.chat-panel{position:fixed;bottom:88px;right:24px;width:380px;max-height:520px;background:#111827;border:1px solid #334155;border-radius:16px;z-index:9998;display:none;flex-direction:column;box-shadow:0 20px 60px -10px rgba(0,0,0,.7)}
.chat-panel.open{display:flex}
.chat-messages{flex:1;overflow-y:auto;padding:16px;min-height:200px;max-height:360px}
.chat-msg{margin-bottom:12px;max-width:85%;padding:10px 14px;border-radius:12px;font-size:13px;line-height:1.5}
.chat-msg.user{background:#1e293b;margin-left:auto;color:#e2e8f0}
.chat-msg.assistant{background:linear-gradient(135deg,rgba(245,158,11,.1),rgba(139,92,246,.1));color:#cbd5e1;border:1px solid #334155}
.chat-input-area{border-top:1px solid #1e293b;padding:12px;display:flex;gap:8px}
.chat-input-area textarea{flex:1;background:#0c0f1a;border:1px solid #334155;border-radius:10px;padding:8px 12px;color:#e2e8f0;font-size:13px;resize:none;outline:none;font-family:inherit}
.chat-input-area textarea:focus{border-color:#8b5cf6}
.chat-input-area button{background:#8b5cf6;color:white;border:none;border-radius:10px;padding:8px 14px;cursor:pointer;font-size:13px;font-weight:600}
.chat-input-area button:disabled{opacity:.4;cursor:not-allowed}

/* Settings modal */
.settings-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:10000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.settings-overlay.open{display:flex}

/* Scenario card */
.scenario-card{transition:all .3s;cursor:pointer}
.scenario-card:hover{transform:translateY(-2px);box-shadow:0 8px 30px -8px rgba(0,0,0,.5)}

@media(max-width:768px){
  .chat-panel{right:12px;left:12px;width:auto;bottom:80px}
  .chat-toggle{bottom:16px;right:16px;width:46px;height:46px}
}

/* Projector-friendly base */
html{font-size:18px}
html.projector{font-size:24px}
html.projector .chat-toggle,html.projector .chat-panel{display:none!important}

/* Toggle switch */
.tgl{position:relative;width:44px;height:24px;background:#334155;border-radius:12px;cursor:pointer;transition:background .3s;flex-shrink:0}
.tgl.on{background:#f59e0b}
.tgl::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;transition:transform .3s}
.tgl.on::after{transform:translateX(20px)}

/* Progress bar */
.flux-progress{position:fixed;top:3.5rem;left:0;right:0;height:3px;z-index:49;background:#1e293b;display:none}
.flux-progress-fill{height:100%;background:linear-gradient(90deg,#f59e0b,#06b6d4,#10b981,#8b5cf6);transition:width .5s;border-radius:0 2px 2px 0}

/* Module group card */
.mod-group{border:1px solid #1e293b;border-radius:1rem;padding:1.25rem;margin-bottom:1rem}
.mod-row{display:flex;align-items:center;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid rgba(30,41,59,.5)}
.mod-row:last-child{border-bottom:none}

/* Reflection FAB */
.refl-fab{position:fixed;bottom:1.5rem;left:1.5rem;width:3rem;height:3rem;border-radius:50%;background:linear-gradient(135deg,#10b981,#06b6d4);cursor:pointer;z-index:9997;display:none;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(16,185,129,.4);transition:transform .3s}
.refl-fab:hover{transform:scale(1.1)}

/* Overlays */
.overlay-modal{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:10001;display:none;align-items:center;justify-content:center;backdrop-filter:blur(6px)}
.overlay-modal.open{display:flex}

/* Diagnostic scale buttons */
.scale-btn{width:2.5rem;height:2.5rem;border-radius:.5rem;border:1px solid #334155;background:#1e293b;color:#94a3b8;cursor:pointer;font-weight:700;transition:all .2s}
.scale-btn:hover{border-color:#f59e0b;color:#f59e0b}
.scale-btn.selected{background:#f59e0b;color:#0c0f1a;border-color:#f59e0b}

/* ROPES wizard */
.ropes-indicator{display:flex;gap:.5rem;justify-content:center;margin-bottom:1rem}
.ropes-dot{width:2rem;height:2rem;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;border:2px solid #334155;color:#64748b;transition:all .3s}
.ropes-dot.active{border-color:#f59e0b;color:#f59e0b;background:rgba(245,158,11,.1)}
.ropes-dot.done{border-color:#10b981;color:#10b981;background:rgba(16,185,129,.1)}

/* Projector toggle btn */
.projector-btn{transition:all .2s}
.projector-btn.on{color:#f59e0b!important}

/* Cloud Tooltip on FLUX wheel */
.flux-tooltip{position:fixed;z-index:100;max-width:320px;max-height:360px;overflow-y:auto;padding:1.25rem;background:rgba(17,24,39,.95);backdrop-filter:blur(12px);border:1px solid rgba(51,65,85,.5);border-radius:1rem;box-shadow:0 20px 60px -10px rgba(0,0,0,.7);opacity:0;transform:translateY(8px);transition:opacity .3s,transform .3s;pointer-events:none}
.flux-tooltip.visible{opacity:1;transform:translateY(0);pointer-events:auto}
.flux-tooltip::after{content:'';position:absolute;width:12px;height:12px;background:rgba(17,24,39,.95);border:1px solid rgba(51,65,85,.5);transform:rotate(45deg)}
.flux-tooltip.tt-fast::after{bottom:-7px;left:30%;border-top:none;border-left:none}
.flux-tooltip.tt-liquid::after{top:-7px;left:30%;border-bottom:none;border-right:none}
.flux-tooltip.tt-unlearn::after{top:-7px;right:30%;border-bottom:none;border-left:none}
.flux-tooltip.tt-experiment::after{bottom:-7px;right:30%;border-top:none;border-right:none}
html.projector .flux-tooltip{max-width:420px;font-size:1.1rem;padding:1.5rem}
@media(max-width:768px){.flux-tooltip{max-width:280px;padding:1rem}}

/* Mini tooltip for FLUX badges */
#mini-tooltip{animation:fadeUp .2s ease}

/* Megaworld badge */
.mw-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:9999px;font-size:10px;font-weight:600;white-space:nowrap}
</style>
</head>
<body class="min-h-screen text-slate-100">

<!-- ========== NAV ========== -->
<nav class="fixed top-0 left-0 right-0 z-50 bg-dark-950/90 backdrop-blur-xl border-b border-dark-700/50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-amber-500 via-cyan-500 to-violet-500 flex items-center justify-center"><span class="text-[10px] font-black text-white">F</span></div>
      <span class="font-bold text-base">FLUX</span>
      <span class="text-slate-600 text-xs hidden sm:inline">| Nowe Motywacje</span>
    </div>
    <!-- Desktop nav -->
    <div class="hidden md:flex items-center gap-6">
      <a onclick="nav('home')" class="nav-link active text-xs font-medium text-slate-400 hover:text-white cursor-pointer" data-v="home">Model</a>
      <a onclick="nav('explore')" class="nav-link text-xs font-medium text-slate-400 hover:text-white cursor-pointer" data-v="explore">Eksplorator</a>
      <a onclick="nav('trends')" class="nav-link text-xs font-medium text-slate-400 hover:text-white cursor-pointer" data-v="trends">Trendy</a>
      <a onclick="nav('research')" class="nav-link text-xs font-medium text-slate-400 hover:text-white cursor-pointer" data-v="research">Badania</a>
      <a onclick="nav('tools')" class="nav-link text-xs font-medium text-slate-400 hover:text-white cursor-pointer" data-v="tools">NarzÄ™dzia</a>
      <button onclick="toggleProjector()" class="projector-btn text-slate-500 hover:text-white transition-colors" title="Tryb projektorowy">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
      </button>
      <button onclick="openSettings()" class="text-slate-500 hover:text-white transition-colors" title="Ustawienia">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      </button>
    </div>
    <!-- Mobile hamburger -->
    <button class="hamburger md:hidden" onclick="toggleMobile()"><span></span><span></span><span></span></button>
  </div>
  <!-- Mobile menu -->
  <div class="mobile-menu md:hidden bg-dark-950 border-t border-dark-700/50 px-4">
    <div class="py-3 space-y-2">
      <a onclick="nav('home');toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">Model FLUX</a>
      <a onclick="nav('explore');toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">Eksplorator</a>
      <a onclick="nav('trends');toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">Trendy</a>
      <a onclick="nav('research');toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">Badania</a>
      <a onclick="nav('tools');toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">NarzÄ™dzia</a>
      <a onclick="openSettings();toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">Ustawienia Gemini</a>
    </div>
  </div>
</nav>

<!-- ========== HOME ========== -->
<section id="view-home" class="view active pt-16">
<div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h1 class="text-4xl sm:text-5xl font-black"><span class="text-amber-400">F</span><span class="text-cyan-400">L</span><span class="text-emerald-400">U</span><span class="text-violet-400">X</span> <span class="text-white">Model</span></h1>
    <p class="text-slate-400 text-base sm:text-lg mt-2 max-w-xl mx-auto">Rama kompetencyjno-operacyjna do funkcjonowania w Å›wiecie zmiennoÅ›ci.</p>
  </div>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
    <!-- Left cards -->
    <div class="space-y-3 order-2 lg:order-1">
      <div class="fcard rounded-xl p-4 bg-dark-900 cursor-pointer" style="--glow:rgba(245,158,11,.15)" onclick="showDetail('fast')">
        <div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center"><span class="text-amber-400 font-black">F</span></div><div><h3 class="font-bold text-sm text-amber-400">FAST</h3><p class="text-[10px] text-slate-500">Tempo decyzji i dziaÅ‚ania</p></div></div>
        <p class="text-xs text-slate-400">Szybkie reagowanie i podejmowanie decyzji w warunkach niepewnoÅ›ci.</p>
      </div>
      <div class="fcard rounded-xl p-4 bg-dark-900 cursor-pointer" style="--glow:rgba(16,185,129,.15)" onclick="showDetail('unlearn')">
        <div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center"><span class="text-emerald-400 font-black">U</span></div><div><h3 class="font-bold text-sm text-emerald-400">UNLEARN & RELEARN</h3><p class="text-[10px] text-slate-500">Uczenie siÄ™ i aktualizacja</p></div></div>
        <p class="text-xs text-slate-400">Åšwiadome porzucanie przestarzaÅ‚ych modeli mentalnych.</p>
      </div>
    </div>
    <!-- Diagram -->
    <div class="flex justify-center order-1 lg:order-2" style="position:relative">
      <div class="w-full max-w-[440px] aspect-square">
        <svg viewBox="0 0 800 800" class="w-full h-full">
          <defs><radialGradient id="cg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#1e293b"/><stop offset="100%" stop-color="#0c0f1a"/></radialGradient></defs>
          <circle cx="400" cy="400" r="350" fill="none" stroke="#1e293b" stroke-width=".5" stroke-dasharray="4 4"/>
          <circle cx="400" cy="400" r="260" fill="none" stroke="#1e293b" stroke-width=".5" stroke-dasharray="4 4"/>
          <line x1="400" y1="50" x2="400" y2="750" stroke="#1e293b" stroke-width=".5"/>
          <line x1="50" y1="400" x2="750" y2="400" stroke="#1e293b" stroke-width=".5"/>
          <g class="flux-quadrant" onclick="showDetail('fast')"><path d="M400,400 L400,50 A350,350 0 0,1 750,400 Z" class="qf" fill="#f59e0b" opacity=".12"/><text x="570" y="210" text-anchor="middle" fill="#f59e0b" font-size="24" font-weight="800" letter-spacing="3">FAST</text><text x="570" y="230" text-anchor="middle" fill="#f59e0b" font-size="9" opacity=".5">Tempo decyzji</text></g>
          <g class="flux-quadrant" onclick="showDetail('liquid')"><path d="M400,400 L750,400 A350,350 0 0,1 400,750 Z" class="qf" fill="#06b6d4" opacity=".12"/><text x="570" y="580" text-anchor="middle" fill="#06b6d4" font-size="24" font-weight="800" letter-spacing="3">LIQUID</text><text x="570" y="600" text-anchor="middle" fill="#06b6d4" font-size="9" opacity=".5">WspÃ³Å‚praca</text></g>
          <g class="flux-quadrant" onclick="showDetail('unlearn')"><path d="M400,400 L400,750 A350,350 0 0,1 50,400 Z" class="qf" fill="#10b981" opacity=".12"/><text x="230" y="580" text-anchor="middle" fill="#10b981" font-size="20" font-weight="800" letter-spacing="2">UNLEARN</text><text x="230" y="600" text-anchor="middle" fill="#10b981" font-size="9" opacity=".5">Adaptacja</text></g>
          <g class="flux-quadrant" onclick="showDetail('experiment')"><path d="M400,400 L50,400 A350,350 0 0,1 400,50 Z" class="qf" fill="#8b5cf6" opacity=".12"/><text x="220" y="210" text-anchor="middle" fill="#8b5cf6" font-size="18" font-weight="800" letter-spacing="2">EXPERIMENT</text><text x="220" y="230" text-anchor="middle" fill="#8b5cf6" font-size="9" opacity=".5">Innowacje</text></g>
          <!-- Trend dots (dynamically populated) -->
          <g id="wheel-trend-dots"></g>
          <circle cx="400" cy="400" r="65" fill="url(#cg)" stroke="#334155" stroke-width="1"/>
          <circle cx="400" cy="400" r="70" fill="none" stroke="#f59e0b" stroke-width=".5" opacity=".3" class="center-pulse"/>
          <text x="400" y="395" text-anchor="middle" fill="white" font-size="26" font-weight="900" letter-spacing="5">FLUX</text>
          <text x="400" y="414" text-anchor="middle" fill="#64748b" font-size="8" letter-spacing="2">KLIKNIJ OBSZAR</text>
        </svg>
      </div>
    </div>
    <!-- Right cards -->
    <div class="space-y-3 order-3">
      <div class="fcard rounded-xl p-4 bg-dark-900 cursor-pointer" style="--glow:rgba(6,182,212,.15)" onclick="showDetail('liquid')">
        <div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center"><span class="text-cyan-400 font-black">L</span></div><div><h3 class="font-bold text-sm text-cyan-400">LIQUID</h3><p class="text-[10px] text-slate-500">WspÃ³Å‚praca i przepÅ‚yw</p></div></div>
        <p class="text-xs text-slate-400">PÅ‚ynnoÅ›Ä‡ struktur, rÃ³l i przepÅ‚ywu wiedzy. BezpieczeÅ„stwo psychologiczne.</p>
      </div>
      <div class="fcard rounded-xl p-4 bg-dark-900 cursor-pointer" style="--glow:rgba(139,92,246,.15)" onclick="showDetail('experiment')">
        <div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 rounded-lg bg-violet-500/20 flex items-center justify-center"><span class="text-violet-400 font-black">X</span></div><div><h3 class="font-bold text-sm text-violet-400">EXPERIMENT</h3><p class="text-[10px] text-slate-500">Eksperymentowanie</p></div></div>
        <p class="text-xs text-slate-400">Systematyczne testowanie hipotez, uczenie siÄ™ z bÅ‚Ä™dÃ³w.</p>
      </div>
    </div>
  </div>
  <!-- Evolution bar -->
  <div class="mt-8 bg-dark-900/50 border border-dark-700/50 rounded-xl p-4">
    <div class="flex items-center justify-center gap-3 overflow-x-auto text-xs">
      <span class="px-3 py-1 rounded-lg bg-slate-800/50 text-slate-500 whitespace-nowrap">VUCA <span class="text-[9px] text-slate-600">1987</span></span>
      <span class="text-slate-700">â†’</span>
      <span class="px-3 py-1 rounded-lg bg-slate-800/50 text-slate-500 whitespace-nowrap">BANI <span class="text-[9px] text-slate-600">2020</span></span>
      <span class="text-slate-700">â†’</span>
      <span class="px-4 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/10 via-cyan-500/10 to-violet-500/10 border border-amber-500/20 whitespace-nowrap font-bold bg-clip-text"><span class="bg-gradient-to-r from-amber-400 via-cyan-400 to-violet-400 bg-clip-text text-transparent">FLUX</span> <span class="text-[9px] text-slate-400">2025+</span></span>
    </div>
  </div>
</div>
</section>

<!-- ========== DETAIL ========== -->
<section id="view-detail" class="view pt-16">
<div class="max-w-5xl mx-auto px-4 sm:px-6 py-6">
  <button onclick="nav('home')" class="flex items-center gap-1 text-xs text-slate-500 hover:text-white mb-4"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>PowrÃ³t</button>
  <div id="detail-header"></div>
  <div class="flex gap-4 border-b border-dark-700 mb-4 mt-4 overflow-x-auto" id="detail-tabs"></div>
  <div id="detail-content"></div>
</div>
</section>

<!-- ========== EXPLORE (SCENARIOS + FILTERS) ========== -->
<section id="view-explore" class="view pt-16">
<div class="max-w-6xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">Eksplorator <span class="text-amber-400">FLUX</span></h2>
    <p class="text-slate-400 text-sm">Filtruj scenariusze po roli, branÅ¼y, sytuacji i typie wyzwania.</p>
  </div>
  <!-- FILTER BAR -->
  <div class="bg-dark-900 border border-dark-700 rounded-xl p-4 mb-6 space-y-3" id="filter-bar">
    <!-- FLUX Area -->
    <div>
      <p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Obszar FLUX</p>
      <div class="flex flex-wrap gap-1.5">
        <span class="chip on text-sm px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 border border-slate-700" style="--ring:#94a3b8" data-f="area" data-v="all" onclick="toggleFilter(this)">Wszystkie</span>
        <span class="chip text-sm px-4 py-1.5 rounded-full bg-amber-500/10 text-amber-400 border border-amber-500/20" style="--ring:#f59e0b" data-f="area" data-v="fast" onclick="toggleFilter(this)">F â€” FAST</span>
        <span class="chip text-sm px-4 py-1.5 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-500/20" style="--ring:#06b6d4" data-f="area" data-v="liquid" onclick="toggleFilter(this)">L â€” LIQUID</span>
        <span class="chip text-sm px-4 py-1.5 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20" style="--ring:#10b981" data-f="area" data-v="unlearn" onclick="toggleFilter(this)">U â€” UNLEARN</span>
        <span class="chip text-sm px-4 py-1.5 rounded-full bg-violet-500/10 text-violet-400 border border-violet-500/20" style="--ring:#8b5cf6" data-f="area" data-v="experiment" onclick="toggleFilter(this)">X â€” EXPERIMENT</span>
      </div>
    </div>
    <!-- Industry -->
    <div>
      <p class="text-xs uppercase tracking-widest text-slate-500 mb-2">BranÅ¼a</p>
      <div class="flex flex-wrap gap-1.5" id="industry-chips"></div>
    </div>
    <!-- Role type -->
    <div>
      <p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Rola / Stanowisko</p>
      <div class="flex flex-wrap gap-1.5" id="role-chips"></div>
    </div>
    <!-- Situation -->
    <div>
      <p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Sytuacja</p>
      <div class="flex flex-wrap gap-1.5" id="situation-chips"></div>
    </div>
    <!-- Life context -->
    <div>
      <p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Kontekst Å¼yciowy</p>
      <div class="flex flex-wrap gap-1.5" id="context-chips"></div>
    </div>
    <!-- Challenge type -->
    <div>
      <p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Typ wyzwania</p>
      <div class="flex flex-wrap gap-1.5" id="challenge-chips"></div>
    </div>
    <div class="flex justify-between items-center pt-2 border-t border-dark-700">
      <span class="text-[10px] text-slate-600" id="result-count">0 scenariuszy</span>
      <button onclick="resetFilters()" class="text-[10px] text-slate-500 hover:text-white">Resetuj filtry</button>
    </div>
  </div>
  <!-- Results -->
  <div id="explore-results" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
</div>
</section>

<!-- ========== TRENDS ========== -->
<section id="view-trends" class="view pt-16">
<div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">Mapa TrendÃ³w <span class="text-amber-400">FLUX</span></h2>
    <p class="text-slate-400 text-sm">Trendy wg horyzontu czasowego i obszaru FLUX.</p>
  </div>
  <div class="flex justify-center gap-2 mb-6 flex-wrap">
    <button onclick="filterTrends('all')" class="tf on px-3 py-1 rounded-full text-[11px] bg-slate-800 text-slate-300 border border-slate-700">Wszystkie</button>
    <button onclick="filterTrends('fast')" class="tf px-3 py-1 rounded-full text-[11px] bg-amber-500/10 text-amber-400 border border-amber-500/20">FAST</button>
    <button onclick="filterTrends('liquid')" class="tf px-3 py-1 rounded-full text-[11px] bg-cyan-500/10 text-cyan-400 border border-cyan-500/20">LIQUID</button>
    <button onclick="filterTrends('unlearn')" class="tf px-3 py-1 rounded-full text-[11px] bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">UNLEARN</button>
    <button onclick="filterTrends('experiment')" class="tf px-3 py-1 rounded-full text-[11px] bg-violet-500/10 text-violet-400 border border-violet-500/20">EXPERIMENT</button>
  </div>
  <div class="flex justify-center"><div class="w-full max-w-[700px] aspect-square"><svg id="trend-map" viewBox="0 0 1000 1000" class="w-full h-full"></svg></div></div>
  <div id="trend-filters" class="mt-4 max-w-3xl mx-auto"></div>
  <div class="flex justify-center gap-6 mt-4 text-[10px] text-slate-500 flex-wrap">
    <span class="flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-white/30"></span>NOW</span>
    <span class="flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-white/20"></span>NEW 1â€“2y</span>
    <span class="flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-white/10"></span>NEXT 3â€“5y</span>
    <span class="flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-white/5"></span>BEYOND 5+</span>
  </div>
</div>
</section>

<!-- ========== RESEARCH ========== -->
<section id="view-research" class="view pt-16">
<div class="max-w-5xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">Biblioteka <span class="text-emerald-400">BadaÅ„</span></h2>
    <p class="text-slate-400 text-sm">Evidence-based: badania naukowe stojÄ…ce za modelem FLUX.</p>
  </div>
  <div class="flex justify-center gap-2 mb-6 flex-wrap">
    <button onclick="filterRes('all')" class="rf on px-3 py-1 rounded-full text-[11px] bg-slate-800 text-slate-300 border border-slate-700">Wszystkie</button>
    <button onclick="filterRes('fast')" class="rf px-3 py-1 rounded-full text-[11px] bg-amber-500/10 text-amber-400 border border-amber-500/20">FAST</button>
    <button onclick="filterRes('liquid')" class="rf px-3 py-1 rounded-full text-[11px] bg-cyan-500/10 text-cyan-400 border border-cyan-500/20">LIQUID</button>
    <button onclick="filterRes('unlearn')" class="rf px-3 py-1 rounded-full text-[11px] bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">UNLEARN</button>
    <button onclick="filterRes('experiment')" class="rf px-3 py-1 rounded-full text-[11px] bg-violet-500/10 text-violet-400 border border-violet-500/20">EXPERIMENT</button>
  </div>
  <div id="research-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
</div>
</section>

<!-- ========== TOOLS ========== -->
<section id="view-tools" class="view pt-16">
<div class="max-w-5xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">NarzÄ™dzia <span class="text-violet-400">FLUX</span></h2>
    <p class="text-slate-400 text-sm">Gotowe klocki: checklisty, canvasy, prompty, diagnostyki.</p>
  </div>
  <div id="tools-grid"></div>
</div>
</section>

<!-- ========== DIAGNOSTIC ========== -->
<section id="view-diagnostic" class="view pt-16">
<div class="max-w-4xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">Diagnostyka <span class="text-amber-400">FLUX</span></h2>
    <p class="text-slate-400 text-sm">OceÅ„ swoje kompetencje w 4 obszarach FLUX (skala 1-5).</p>
  </div>
  <div id="diagnostic-content"></div>
</div>
</section>

<!-- ========== ACTION PLAN ========== -->
<section id="view-actionplan" class="view pt-16">
<div class="max-w-4xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">Action Plan <span class="text-amber-400">Builder</span></h2>
    <p class="text-slate-400 text-sm">Zaplanuj konkretne dziaÅ‚ania z deadlinami i metrykami sukcesu.</p>
  </div>
  <div id="actionplan-content"></div>
</div>
</section>

<!-- ========== TRAINER ========== -->
<section id="view-trainer" class="view pt-16">
<div class="max-w-5xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">Trainer <span class="text-violet-400">Dashboard</span></h2>
    <p class="text-slate-400 text-sm">Panel trenera: QR code, diagnostyki, gap analysis.</p>
  </div>
  <div id="trainer-content"></div>
</div>
</section>

<!-- ========== MODULES ========== -->
<section id="view-modules" class="view pt-16">
<div class="max-w-3xl mx-auto px-4 sm:px-6 py-6">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-black">ModuÅ‚y <span class="text-amber-400">FLUX</span></h2>
    <p class="text-slate-400 text-sm">WÅ‚Ä…czaj i wyÅ‚Ä…czaj funkcje aplikacji wg potrzeb.</p>
  </div>
  <div id="modules-content"></div>
</div>
</section>

<!-- ========== PROGRESS BAR ========== -->
<div class="flux-progress" id="progress-bar"><div class="flux-progress-fill" id="progress-fill" style="width:0%"></div></div>

<!-- ========== ONBOARDING MODAL ========== -->
<div class="overlay-modal" id="onboarding-overlay">
  <div class="bg-dark-900 border border-dark-700 rounded-2xl p-6 max-w-lg w-full mx-4">
    <div id="onboarding-content"></div>
  </div>
</div>

<!-- ========== REFLECTION MODAL ========== -->
<div class="overlay-modal" id="reflection-overlay" onclick="if(event.target===this)closeReflection()">
  <div class="bg-dark-900 border border-dark-700 rounded-2xl p-6 max-w-lg w-full mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="font-bold text-slate-200">Refleksja 3-2-1</h3>
      <button onclick="closeReflection()" class="text-slate-500 hover:text-white"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <div class="space-y-3">
      <div><label class="text-xs text-amber-400 font-medium">3 rzeczy, ktÃ³re zapamiÄ™tam</label><textarea id="refl-3" rows="2" class="w-full mt-1 bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-amber-500 resize-none"></textarea></div>
      <div><label class="text-xs text-cyan-400 font-medium">2 pytania, ktÃ³re mam</label><textarea id="refl-2" rows="2" class="w-full mt-1 bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-cyan-500 resize-none"></textarea></div>
      <div><label class="text-xs text-emerald-400 font-medium">1 dziaÅ‚anie, ktÃ³re podejmÄ™</label><textarea id="refl-1" rows="2" class="w-full mt-1 bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-emerald-500 resize-none"></textarea></div>
    </div>
    <div class="flex gap-2 mt-4">
      <button onclick="saveReflection()" class="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-medium py-2 rounded-lg">Zapisz</button>
      <button onclick="saveAndAskAI()" class="flex-1 bg-violet-600 hover:bg-violet-500 text-white text-sm font-medium py-2 rounded-lg">Zapisz + Zapytaj AI</button>
    </div>
    <p id="refl-status" class="text-xs mt-2 h-4"></p>
  </div>
</div>

<!-- ========== REFLECTION FAB ========== -->
<div class="refl-fab" id="refl-fab" onclick="openReflection()" title="Refleksja 3-2-1">
  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
</div>

<!-- ========== GEMINI CHAT WIDGET ========== -->
<div class="chat-toggle" onclick="toggleChat()" title="Zapytaj AI o FLUX">
  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
</div>
<div class="chat-panel" id="chat-panel">
  <div class="p-3 border-b border-dark-700 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="w-6 h-6 rounded-full bg-gradient-to-br from-amber-500 to-violet-500 flex items-center justify-center"><span class="text-[8px] font-black text-white">AI</span></div>
      <span class="text-sm font-semibold text-slate-200">FLUX Asystent</span>
      <span class="text-[9px] text-slate-600">Gemini</span>
    </div>
    <button onclick="toggleChat()" class="text-slate-500 hover:text-white"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
  </div>
  <div class="chat-messages" id="chat-messages">
    <div class="chat-msg assistant">CzeÅ›Ä‡! Jestem asystentem FLUX. Zapytaj mnie o model, scenariusze, narzÄ™dzia lub jak zastosowaÄ‡ FLUX w Twojej branÅ¼y.</div>
  </div>
  <div id="chat-status" class="px-4 text-[10px] text-violet-400 h-4"></div>
  <div class="chat-input-area">
    <textarea id="chat-input" rows="1" placeholder="Zapytaj o FLUX..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendChat()}"></textarea>
    <button onclick="sendChat()" id="chat-send">WyÅ›lij</button>
  </div>
</div>

<!-- ========== SETTINGS ========== -->
<div class="settings-overlay" id="settings-overlay" onclick="if(event.target===this)closeSettings()">
  <div class="bg-dark-900 border border-dark-700 rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="font-bold text-slate-200">Ustawienia Gemini API</h3>
      <button onclick="closeSettings()" class="text-slate-500 hover:text-white"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
    </div>
    <p class="text-xs text-slate-400 mb-4">Klucz API Gemini z <a href="https://aistudio.google.com/apikey" target="_blank" class="text-violet-400 hover:underline">aistudio.google.com</a> (darmowy).</p>
    <input type="password" id="api-key-input" placeholder="AIza..." class="w-full bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-violet-500 mb-3">
    <div class="flex gap-2">
      <button onclick="saveApiKey()" class="flex-1 bg-violet-600 hover:bg-violet-500 text-white text-sm font-medium py-2 rounded-lg transition-colors">Zapisz</button>
      <button onclick="clearApiKey()" class="px-4 bg-slate-800 hover:bg-slate-700 text-slate-300 text-sm py-2 rounded-lg transition-colors">WyczyÅ›Ä‡</button>
    </div>
    <p id="settings-status" class="text-xs mt-2 h-4"></p>
  </div>
</div>

<!-- Wheel tooltip (fixed position, appended to body) -->
<div id="flux-tooltip" class="flux-tooltip"></div>

<!-- ========== SCRIPTS ========== -->
<script>
// ===== COLORS & CLASSES =====
const C={fast:'#f59e0b',liquid:'#06b6d4',unlearn:'#10b981',experiment:'#8b5cf6'};
const CC={fast:{t:'text-amber-400',bg:'bg-amber-500/10',b:'border-amber-500/20'},liquid:{t:'text-cyan-400',bg:'bg-cyan-500/10',b:'border-cyan-500/20'},unlearn:{t:'text-emerald-400',bg:'bg-emerald-500/10',b:'border-emerald-500/20'},experiment:{t:'text-violet-400',bg:'bg-violet-500/10',b:'border-violet-500/20'}};

// ===== MODULE SYSTEM =====
const MODULES=[
  {id:'diagnostic',name:'Diagnostyka FLUX',group:'Wiedza',icon:'ğŸ“Š',desc:'Autodiagnoza 16 pytaÅ„ + radar chart',nav:true},
  {id:'radar',name:'Radar Chart',group:'Wiedza',icon:'ğŸ¯',desc:'Spider chart profilu FLUX'},
  {id:'actionplan',name:'Action Plan Builder',group:'Wiedza',icon:'ğŸ“‹',desc:'DziaÅ‚ania z deadlinami i metrykami',nav:true},
  {id:'trainer',name:'Trainer Dashboard',group:'Wiedza',icon:'ğŸ“',desc:'QR, gap analysis, eksport raportu',nav:true},
  {id:'casestudies',name:'Deep Case Studies',group:'ÅšcieÅ¼ka',icon:'ğŸ“–',desc:'Rozbudowane analizy SCAR'},
  {id:'evidence',name:'Evidence Cards',group:'ÅšcieÅ¼ka',icon:'ğŸ”¬',desc:'Tier badaÅ„ przy scenariuszach'},
  {id:'antipatterns',name:'Antywzorce Detector',group:'ÅšcieÅ¼ka',icon:'ğŸš¨',desc:'Interaktywna diagnoza antywzorcÃ³w'},
  {id:'frameworks',name:'Personal Frameworks',group:'ÅšcieÅ¼ka',icon:'ğŸ§©',desc:'NVC, STOPâ†’THINKâ†’ACT, Atomic Habits'},
  {id:'exercises',name:'Interactive Exercises',group:'ÅšcieÅ¼ka',icon:'ğŸ‹ï¸',desc:'Quiz, speed round, ranking'},
  {id:'canvases',name:'Downloadable Canvases',group:'ÅšcieÅ¼ka',icon:'ğŸ“¥',desc:'Pobierz canvasy do druku'},
  {id:'ropes',name:'ROPES Learning Path',group:'UX',icon:'ğŸ§­',desc:'5-krokowy wizard nauki'},
  {id:'onboarding',name:'Onboarding Wizard',group:'UX',icon:'ğŸ‘‹',desc:'Profil roli, branÅ¼y, wyzwania'},
  {id:'reflection',name:'Refleksja 3-2-1',group:'UX',icon:'ğŸ’­',desc:'3 rzeczy / 2 pytania / 1 dziaÅ‚anie'},
  {id:'progress',name:'Progress Tracker',group:'UX',icon:'ğŸ“ˆ',desc:'Åšledzenie postÄ™pÃ³w, bookmarki'},
  {id:'mobileux',name:'Mobile UX',group:'UX',icon:'ğŸ“±',desc:'Bottom nav, sticky filters'}
];

function getModuleState(){try{return JSON.parse(localStorage.getItem('flux_modules')||'{}')}catch(e){return{}}}
function setModuleState(s){localStorage.setItem('flux_modules',JSON.stringify(s))}
function isModuleOn(id){return getModuleState()[id]===true}
function toggleModule(id){const s=getModuleState();s[id]=!s[id];setModuleState(s);applyModules()}

function applyModules(){
  renderNav();
  // Progress bar
  document.getElementById('progress-bar').style.display=isModuleOn('progress')?'block':'none';
  if(isModuleOn('progress'))updateProgressBar();
  // Reflection FAB
  document.getElementById('refl-fab').style.display=isModuleOn('reflection')?'flex':'none';
  // Onboarding check
  if(isModuleOn('onboarding')&&!localStorage.getItem('flux_profile'))showOnboarding();
  // Re-render current view if module-dependent
  renderModulesView();
}

function renderNav(){
  const base=[
    {id:'home',label:'Model'},{id:'explore',label:'Eksplorator'},{id:'trends',label:'Trendy'},
    {id:'research',label:'Badania'},{id:'tools',label:'NarzÄ™dzia'}
  ];
  const modNav=MODULES.filter(m=>m.nav&&isModuleOn(m.id)).map(m=>({id:m.id,label:m.name.split(' ')[0]}));
  const all=[...base,...modNav,{id:'modules',label:'ModuÅ‚y'}];
  // Desktop
  const dNav=document.querySelector('.hidden.md\\:flex');
  if(dNav){
    const btns=dNav.querySelectorAll('button');
    const btnHtml=Array.from(btns).map(b=>b.outerHTML).join('');
    dNav.innerHTML=all.map(n=>`<a onclick="nav('${n.id}')" class="nav-link text-xs font-medium text-slate-400 hover:text-white cursor-pointer" data-v="${n.id}">${n.label}</a>`).join('')+btnHtml;
  }
  // Mobile
  const mMenu=document.querySelector('.mobile-menu .py-3');
  if(mMenu)mMenu.innerHTML=all.map(n=>`<a onclick="nav('${n.id}');toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">${n.label}</a>`).join('')+`<a onclick="openSettings();toggleMobile()" class="block py-2 text-sm text-slate-400 hover:text-white cursor-pointer">Ustawienia Gemini</a>`;
}

function renderModulesView(){
  const el=document.getElementById('modules-content');if(!el)return;
  const state=getModuleState();
  const groups=['Wiedza','ÅšcieÅ¼ka','UX'];
  el.innerHTML=groups.map(g=>{
    const mods=MODULES.filter(m=>m.group===g);
    return`<div class="mod-group"><h3 class="text-sm font-bold text-slate-300 mb-3">${g}</h3>${mods.map(m=>`<div class="mod-row"><div class="flex items-center gap-3"><span class="text-lg">${m.icon}</span><div><p class="text-sm font-medium text-slate-200">${m.name}</p><p class="text-xs text-slate-500">${m.desc}</p></div></div><div class="tgl ${state[m.id]?'on':''}" onclick="toggleModule('${m.id}');renderModulesView()"></div></div>`).join('')}</div>`;
  }).join('')+`<div class="text-center mt-4"><button onclick="enableAllModules()" class="text-xs text-amber-400 hover:underline mr-4">WÅ‚Ä…cz wszystkie</button><button onclick="disableAllModules()" class="text-xs text-slate-500 hover:underline">WyÅ‚Ä…cz wszystkie</button></div>`;
}

function enableAllModules(){const s={};MODULES.forEach(m=>s[m.id]=true);setModuleState(s);applyModules()}
function disableAllModules(){setModuleState({});applyModules()}

// Projector mode
function toggleProjector(){
  document.documentElement.classList.toggle('projector');
  const on=document.documentElement.classList.contains('projector');
  localStorage.setItem('flux_projector',on?'1':'0');
  document.querySelector('.projector-btn')?.classList.toggle('on',on);
}

// ===== FLUX CORE DATA =====
const FLUX={
  fast:{letter:'F',name:'FAST',full:'Tempo decyzji i dziaÅ‚ania',color:'#f59e0b',
    def:'Szybkie reagowanie i podejmowanie decyzji w warunkach niepewnoÅ›ci. Eliminacja zbÄ™dnych opÃ³ÅºnieÅ„.',
    q:'Jak szybko TwÃ³j zespÃ³Å‚ przechodzi od sygnaÅ‚u do dziaÅ‚ania?',
    anti:['ParaliÅ¼ analityczny â€” â€potrzebujemy jeszcze jednej analizy"','Nadmierne komitety â€” decyzja przechodzi przez 5 poziomÃ³w','Czekanie na peÅ‚ne dane','ReaktywnoÅ›Ä‡ bez refleksji'],
    levels:[{l:'PoczÄ…tkujÄ…cy',d:'Rozpoznaje potrzebÄ™ szybszych decyzji'},{l:'Praktyk',d:'Checklisty decyzyjne, skrÃ³cone cykle'},{l:'Zaawansowany',d:'Autonomiczne zespoÅ‚y, sensing + responding'}]},
  liquid:{letter:'L',name:'LIQUID',full:'WspÃ³Å‚praca i przepÅ‚yw',color:'#06b6d4',
    def:'PÅ‚ynnoÅ›Ä‡ struktur, rÃ³l i przepÅ‚ywu wiedzy. BezpieczeÅ„stwo psychologiczne jako fundament.',
    q:'Czy ludzie czujÄ… siÄ™ bezpiecznie, mÃ³wiÄ…c co myÅ›lÄ…?',
    anti:['Silosy â€” â€to nie moja odpowiedzialnoÅ›Ä‡"','Brak feedbacku â€” bÅ‚Ä™dy siÄ™ powtarzajÄ…','Hierarchia blokujÄ…ca','Spotkania bez wartoÅ›ci'],
    levels:[{l:'PoczÄ…tkujÄ…cy',d:'Rozumie PS, ale nie mierzy'},{l:'Praktyk',d:'Retrospektywy, feedback loops'},{l:'Zaawansowany',d:'Kultura otwartoÅ›ci, self-organizing'}]},
  unlearn:{letter:'U',name:'UNLEARN & RELEARN',full:'Uczenie siÄ™ i aktualizacja',color:'#10b981',
    def:'Åšwiadome porzucanie przestarzaÅ‚ych modeli mentalnych. W erze AI â€” ciÄ…gÅ‚a aktualizacja.',
    q:'Kiedy ostatnio zespÃ³Å‚ Å›wiadomie porzuciÅ‚ stary sposÃ³b dziaÅ‚ania?',
    anti:['â€Zawsze tak robiliÅ›my"','OpÃ³r przed AI','Ignorowanie danych','Szkolenie = event jednorazowy'],
    levels:[{l:'PoczÄ…tkujÄ…cy',d:'Dostrzega potrzebÄ™ aktualizacji'},{l:'Praktyk',d:'PrzeglÄ…dy kompetencji, AI eksperymenty'},{l:'Zaawansowany',d:'Organizacja uczÄ…ca siÄ™'}]},
  experiment:{letter:'X',name:'EXPERIMENT',full:'Eksperymentowanie i innowacje',color:'#8b5cf6',
    def:'Systematyczne testowanie hipotez. Eksperyment to ÅºrÃ³dÅ‚o danych, nie poraÅ¼ka.',
    q:'Ile eksperymentÃ³w przeprowadziÅ‚ TwÃ³j zespÃ³Å‚ w ostatnim kwartale?',
    anti:['Perfekcjonizm â€” â€musi byÄ‡ idealne"','Zero-defect culture','Brak budÅ¼etu na testy','Kopiowanie zamiast testowania'],
    levels:[{l:'PoczÄ…tkujÄ…cy',d:'Pojedyncze prÃ³by bez struktury'},{l:'Praktyk',d:'A/B testy, pilotaÅ¼e, logowanie'},{l:'Zaawansowany',d:'Kultura eksperymentÃ³w'}]}
};

// ===== FILTER DIMENSIONS =====
const INDUSTRIES=[
  {id:'automotive',name:'Automotive',icon:'ğŸš—'},{id:'ecommerce',name:'E-commerce',icon:'ğŸ›’'},
  {id:'pharma',name:'Farmacja',icon:'ğŸ’Š'},{id:'insurance',name:'Ubezpieczenia',icon:'ğŸ›¡ï¸'},
  {id:'oze',name:'OZE / Energia',icon:'âš¡'},{id:'fmcg',name:'FMCG',icon:'ğŸ“¦'},
  {id:'startup',name:'Start-up',icon:'ğŸš€'},{id:'it',name:'IT / Software',icon:'ğŸ’»'},
  {id:'banking',name:'BankowoÅ›Ä‡',icon:'ğŸ¦'},{id:'retail',name:'Handel / Retail',icon:'ğŸ¬'}
];
const ROLES=[
  {id:'manager',name:'Kierownik / Manager'},{id:'teamlead',name:'Team Lead'},
  {id:'specialist',name:'Specjalista'},{id:'agent',name:'Agent / Doradca'},
  {id:'sales',name:'Handlowiec / KAM'},{id:'founder',name:'Founder / C-level'},
  {id:'hr',name:'HR / People'},{id:'trainer',name:'Trener / Coach'}
];
const SITUATIONS=[
  {id:'online',name:'Online / Remote',icon:'ğŸ’»'},{id:'offline',name:'Offline / Sala',icon:'ğŸ¢'},
  {id:'one2one',name:'1:1',icon:'ğŸ‘¤'},{id:'group',name:'Grupowe',icon:'ğŸ‘¥'},
  {id:'crisis',name:'Kryzysowe',icon:'ğŸ”¥'},{id:'hybrid',name:'Hybrydowe',icon:'ğŸ”€'}
];
const LIFE_CONTEXTS=[
  {id:'professional',name:'Zawodowy',icon:'ğŸ’¼'},{id:'leader',name:'Lider zespoÅ‚u',icon:'ğŸ‘‘'},
  {id:'husband',name:'MÄ…Å¼ / Partner',icon:'ğŸ’‘'},{id:'father',name:'Ojciec / Rodzic',icon:'ğŸ‘¨â€ğŸ‘¦'},
  {id:'health',name:'Zdrowie / Nawyki',icon:'ğŸ§˜'},{id:'hobby',name:'Hobby / Pasja',icon:'ğŸï¸'},
  {id:'finance',name:'Finanse',icon:'ğŸ’°'},{id:'learner',name:'UczÄ…cy siÄ™',icon:'ğŸ“š'}
];
const CHALLENGE_TYPES=[
  {id:'decision',name:'Decyzyjne',flux:'fast'},{id:'communication',name:'Komunikacyjne',flux:'liquid'},
  {id:'adaptation',name:'Adaptacyjne',flux:'unlearn'},{id:'innovation',name:'Innowacyjne',flux:'experiment'},
  {id:'trust',name:'Relacyjne / Zaufanie',flux:'liquid'},{id:'learning',name:'Uczeniowe',flux:'unlearn'},
  {id:'speed',name:'Tempo / Presja czasu',flux:'fast'},{id:'error',name:'Kultura bÅ‚Ä™du',flux:'experiment'}
];

// ===== SCENARIOS (multi-tagged) =====
const SCENARIOS=[
  // FAST - professional
  {title:'Decyzja cenowa pod presjÄ…',desc:'Kierownik sprzedaÅ¼y musi odpowiedzieÄ‡ na ofertÄ™ konkurencji w 24h â€” bez czekania na centralÄ™.',area:['fast'],industry:['automotive','fmcg'],role:['manager','sales'],situation:['offline','crisis'],context:['professional','leader'],challenge:['decision','speed'],tip:'UÅ¼yj checklisty "Decyzja w 15 min": co wiem â†’ czego nie wiem â†’ konsekwencje bezczynnoÅ›ci.',fluxWhy:'FAST: 24h okno decyzyjne wymaga eliminacji zbÄ™dnych eskalacji â€” checklista zamiast komitetu.'},
  {title:'Priorytety backlogu w sprincie',desc:'Team lead reaguje na dane z testÃ³w A/B i przesuwa priorytety w Å›rodku sprintu.',area:['fast'],industry:['ecommerce','it','startup'],role:['teamlead','specialist'],situation:['online','group'],context:['professional'],challenge:['decision','speed'],tip:'Decision Log po kaÅ¼dej zmianie priorytetÃ³w â€” 2 min na rationale.',fluxWhy:'FAST: Dane real-time wymagajÄ… natychmiastowej zmiany priorytetÃ³w â€” opÃ³Åºnienie = strata.'},
  {title:'Zmiana regulacji w 48h',desc:'Regionalny musi zmieniÄ‡ przekaz po decyzji regulatora â€” w 48h, bez centralnego briefu.',area:['fast','unlearn'],industry:['pharma'],role:['manager','sales'],situation:['offline'],context:['professional'],challenge:['decision','adaptation'],tip:'Signal Scanning Ritual: co ta zmiana oznacza dla naszych klientÃ³w? Nowy skrypt w 24h.',fluxWhy:'FAST: 48h na zmianÄ™ przekazu â€” nie ma czasu na centralny brief. UNLEARN: stary skrypt nie dziaÅ‚a po zmianie regulacji.'},
  {title:'Decyzja inwestycyjna w niepewnoÅ›ci',desc:'Head of Dev decyduje o projekcie, gdy przepisy mogÄ… siÄ™ zmieniÄ‡ w kwartaÅ‚.',area:['fast'],industry:['oze'],role:['manager','founder'],situation:['offline','group'],context:['professional','leader'],challenge:['decision'],tip:'Scenariusze: co jeÅ›li TAK, co jeÅ›li NIE? Decision Tempo Tracker dla caÅ‚ego pipeline.',fluxWhy:'FAST: NiepewnoÅ›Ä‡ regulacyjna wymaga szybkich scenariuszy zamiast czekania na pewnoÅ›Ä‡.'},
  {title:'OdpowiedÅº na ofertÄ™ w rozmowie',desc:'Agent ubezpieczeniowy musi podjÄ…Ä‡ decyzjÄ™ o ofercie na spotkaniu z klientem â€” teraz, bez "wrÃ³cÄ™ z odpowiedziÄ…".',area:['fast'],industry:['insurance','banking'],role:['agent','sales'],situation:['offline','one2one'],context:['professional'],challenge:['decision','speed'],tip:'Przygotuj "decision tree" dla najczÄ™stszych scenariuszy przed spotkaniem.',fluxWhy:'FAST: Decyzja musi zapaÅ›Ä‡ TU I TERAZ â€” â€wrÃ³cÄ™ z odpowiedziÄ…" = utrata klienta.'},
  // FAST - personal
  {title:'Pilna decyzja finansowa',desc:'Okazja inwestycyjna z 48h oknem â€” jak szybko podjÄ…Ä‡ decyzjÄ™, nie rezygnujÄ…c z analizy?',area:['fast'],industry:[],role:[],situation:['one2one'],context:['finance'],challenge:['decision','speed'],tip:'52 Notatki: masz swojÄ… strategiÄ™ â€” sprawdÅº czy mieÅ›ci siÄ™ w niej ta okazja. TAK/NIE w 30 min.',fluxWhy:'FAST: 48h okno inwestycyjne wymaga szybkiej decyzji w ramach gotowej strategii.'},
  {title:'Kryzys zdrowotny na szkoleniu',desc:'BÃ³l plecÃ³w/migrena przed prowadzeniem 8h warsztatu. Szybka decyzja: jechaÄ‡, zmieniÄ‡ format, odwoÅ‚aÄ‡?',area:['fast'],industry:[],role:['trainer'],situation:['crisis'],context:['health','professional'],challenge:['decision','speed'],tip:'STOP â†’ 3 opcje â†’ wybierz tÄ™ z najmniejszym kosztem dÅ‚ugoterminowym.',fluxWhy:'FAST: Kryzys wymaga natychmiastowej decyzji z 3 wariantÃ³w â€” nie ma czasu na analizÄ™.'},
  // LIQUID - professional
  {title:'Przekaz leadÃ³w bez strat',desc:'Lead z digital trafia do salonu â€” kto przejmuje, jak szybko, z jakim kontekstem?',area:['liquid'],industry:['automotive'],role:['manager','teamlead','sales'],situation:['hybrid'],context:['professional'],challenge:['communication','trust'],tip:'Collaboration Flow Map: kto â†’ komu â†’ co â†’ jak szybko. Zidentyfikuj bottlenecki.',fluxWhy:'LIQUID: PrzepÅ‚yw informacji miÄ™dzy kanaÅ‚ami (digitalâ†’salon) wymaga pÅ‚ynnej struktury i jasnych rÃ³l.'},
  {title:'SpÃ³jnoÅ›Ä‡ komunikacji w terenie',desc:'30 przedstawicieli w 5 regionach mÃ³wi rÃ³Å¼ne rzeczy o tym samym produkcie.',area:['liquid'],industry:['pharma','fmcg'],role:['manager','sales'],situation:['offline','group'],context:['professional','leader'],challenge:['communication'],tip:'Cross-Team Sync: wspÃ³lny brief + cotygodniowy flash update z centrali.',fluxWhy:'LIQUID: 30 osÃ³b Ã— 5 regionÃ³w = chaos bez wspÃ³lnego przepÅ‚ywu wiedzy i synchronizacji.'},
  {title:'BezpieczeÅ„stwo psychologiczne w IT',desc:'Junior developer boi siÄ™ zgÅ‚osiÄ‡ bug w kodzie seniora.',area:['liquid'],industry:['it','startup'],role:['teamlead','specialist'],situation:['online','group'],context:['professional','leader'],challenge:['trust'],tip:'PS Radar co kwartaÅ‚ + retrospektywa: "co utrudnia nam mÃ³wienie prawdy?"',fluxWhy:'LIQUID: Brak PS blokuje przepÅ‚yw informacji o bÅ‚Ä™dach â€” kluczowy element jakoÅ›ci kodu.'},
  {title:'Feedback miÄ™dzy agentami',desc:'DoÅ›wiadczony agent nie dzieli siÄ™ technikami z nowymi â€” â€niech siÄ™ sami nauczÄ…".',area:['liquid'],industry:['insurance','banking'],role:['agent','trainer'],situation:['offline','group'],context:['professional'],challenge:['trust','communication'],tip:'Liquid Collaboration Canvas: zmapuj przepÅ‚ywy wiedzy. Kto jest bottleneckiem?',fluxWhy:'LIQUID: Blokada przepÅ‚ywu wiedzy miÄ™dzy doÅ›wiadczonymi a nowymi â€” bottleneck kompetencji.'},
  // LIQUID - personal
  {title:'Trudna rozmowa z partnerem',desc:'Ola czuje siÄ™ zaniedbana po tygodniu intensywnych szkoleÅ„. Jak rozmawiaÄ‡, nie eskalujÄ…c?',area:['liquid'],industry:[],role:[],situation:['one2one','offline'],context:['husband'],challenge:['communication','trust'],tip:'NVC: obserwacja â†’ uczucia â†’ potrzeby â†’ proÅ›ba. MÃ³w "czujÄ™ X, potrzebujÄ™ Y" nie "Ty zawsze..."',fluxWhy:'LIQUID: Emocje i potrzeby wymagajÄ… pÅ‚ynnego, niehierarchicznego przepÅ‚ywu komunikacji.'},
  {title:'Budowanie zaufania z synem',desc:'Syn (przedszkolak/szkolak) nie chce opowiadaÄ‡ co byÅ‚o w szkole.',area:['liquid'],industry:[],role:[],situation:['one2one','offline'],context:['father'],challenge:['trust','communication'],tip:'15 min "just us" bez ekranÃ³w, bez pytaÅ„. ObecnoÅ›Ä‡ > przesÅ‚uchanie. MÃ³w o swoim dniu pierwszy.',fluxWhy:'LIQUID: Zaufanie = fundament przepÅ‚ywu komunikacji. Bez bezpieczeÅ„stwa psychologicznego syn milczy.'},
  {title:'Feedback w zespole NM',desc:'Chcesz daÄ‡ feedback liderowi z NM, ktÃ³ry stosuje metody, z ktÃ³rymi siÄ™ nie zgadzasz.',area:['liquid'],industry:[],role:['trainer'],situation:['one2one','offline'],context:['professional','leader'],challenge:['communication','trust'],tip:'SBI: Sytuacja â†’ Zachowanie â†’ WpÅ‚yw. Konkretnie, bez osÄ…dzania.',fluxWhy:'LIQUID: Feedback miÄ™dzy liderami wymaga bezpiecznej struktury komunikacji peer-to-peer.'},
  // UNLEARN - professional
  {title:'WdroÅ¼enie AI w zespole sprzedaÅ¼y',desc:'Handlowcy bojÄ… siÄ™ AI â€” â€zastÄ…pi nas". Jak zmieniÄ‡ mindset?',area:['unlearn'],industry:['fmcg','automotive','insurance'],role:['manager','sales','hr'],situation:['group','offline'],context:['professional','leader'],challenge:['adaptation','learning'],tip:'AI Prompt Pack: pokaÅ¼ konkretne use cases (podsumowanie CRM, mail follow-up). Efekt WOW > teoria.',fluxWhy:'UNLEARN: LÄ™k przed AI (AI-fobia) wymaga porzucenia mitu â€AI zastÄ…pi ludzi" na rzecz â€AI wspiera ludzi".'},
  {title:'Zmiana Å›cieÅ¼ki klienta na digital-first',desc:'Klienci kupujÄ… online, ale zespÃ³Å‚ wciÄ…Å¼ optymalizuje proces offline.',area:['unlearn'],industry:['automotive','retail','ecommerce'],role:['manager','teamlead'],situation:['group','hybrid'],context:['professional'],challenge:['adaptation'],tip:'Learning Cycle Canvas: co siÄ™ sprawdza vs co nie â€” dane, nie opinie. Skill Gap Analyzer na dzisiaj.',fluxWhy:'UNLEARN: ZespÃ³Å‚ musi porzuciÄ‡ model offline-first i nauczyÄ‡ siÄ™ digital-first â€” dane > przyzwyczajenia.'},
  {title:'Nowy produkt, stare skrypty',desc:'Nowa terapia wymaga przebudowy pitchu. Stare argumenty nie dziaÅ‚ajÄ….',area:['unlearn'],industry:['pharma','insurance'],role:['sales','trainer'],situation:['offline','group'],context:['professional'],challenge:['adaptation','learning'],tip:'Adaptive Learning Loop: DziaÅ‚aj â†’ Obserwuj â†’ Reflektuj â†’ Adaptuj. 3 tygodnie na nowy skrypt.',fluxWhy:'UNLEARN: Stary skrypt to mentalny model â€” trzeba go Å›wiadomie odrzuciÄ‡, by nowy miaÅ‚ szansÄ™.'},
  // UNLEARN - personal
  {title:'Stare nawyki Å¼ywieniowe',desc:'Wiesz co jest zdrowe, ale wciÄ…Å¼ jesz to co zawsze. Jak zmieniÄ‡?',area:['unlearn'],industry:[],role:[],situation:['one2one'],context:['health'],challenge:['adaptation','learning'],tip:'Atomic Habits: 1 zmiana na 3 tygodnie. Stack na istniejÄ…cym nawyku: "po kawie â†’ szklanka wody".',fluxWhy:'UNLEARN: Nawyki Å¼ywieniowe to gÅ‚Ä™boko zakorzenione wzorce â€” bez oduczenia nowe nie wejdÄ….'},
  {title:'Porzucenie przestarzaÅ‚ej rutyny ojcowskiej',desc:'â€Jak byÅ‚em maÅ‚y to nikt ze mnÄ… nie rozmawiaÅ‚ i wyrosÅ‚em". Ale TwÃ³j syn potrzebuje inaczej.',area:['unlearn'],industry:[],role:[],situation:['one2one','offline'],context:['father'],challenge:['adaptation'],tip:'STOP â†’ THINK â†’ ACT. Co syn potrzebuje TERAZ? Modelowanie > instrukcja.',fluxWhy:'UNLEARN: Model ojcostwa odziedziczony po rodzicach moÅ¼e nie pasowaÄ‡ do potrzeb Twojego dziecka.'},
  {title:'Zmiana podejÅ›cia do finansÃ³w',desc:'â€KiedyÅ› zacznÄ™ oszczÄ™dzaÄ‡" â€” ale kiedy? Zmiana mentalnego modelu pieniÄ™dzy.',area:['unlearn'],industry:[],role:[],situation:['one2one'],context:['finance'],challenge:['adaptation','learning'],tip:'52 Notatki: systematycznoÅ›Ä‡ > kwota. Zacznij od 100 zÅ‚/msc, automatyczny przelew.',fluxWhy:'UNLEARN: â€KiedyÅ› zacznÄ™" to model mentalny do porzucenia â€” systematycznoÅ›Ä‡ > jednorazowy zryw.'},
  // EXPERIMENT - professional
  {title:'Test nowego formatu szkolenia',desc:'Chcesz sprawdziÄ‡ czy 4Ã—2h online > 1Ã—8h offline. Jak zmierzyÄ‡?',area:['experiment'],industry:[],role:['trainer','hr'],situation:['online','group'],context:['professional'],challenge:['innovation','error'],tip:'Hypothesis Builder: "JeÅ›li 4Ã—2h to NPS bÄ™dzie >8 poniewaÅ¼ mniej zmÄ™czenia". Mierz, nie zgaduj.',fluxWhy:'EXPERIMENT: Format szkolenia to hipoteza â€” testuj z metrykami zamiast zakÅ‚adaÄ‡ co dziaÅ‚a.'},
  {title:'A/B test komunikatu sprzedaÅ¼owego',desc:'Dwa warianty pitch\'a â€” ktÃ³ry konwertuje lepiej? Jak testowaÄ‡ w terenie?',area:['experiment'],industry:['fmcg','automotive','insurance'],role:['sales','manager'],situation:['offline'],context:['professional'],challenge:['innovation'],tip:'Experiment Design Kit: grupa A vs B, 2 tygodnie, ta sama baza klientÃ³w. Log wynikÃ³w.',fluxWhy:'EXPERIMENT: Dwa pitche = dwie hipotezy. Kontrolowany test w terenie daje twarde dane.'},
  {title:'PilotaÅ¼ nowego procesu',desc:'Nowy workflow w jednym zespole przed skalowaniem na organizacjÄ™.',area:['experiment'],industry:['it','startup','banking'],role:['teamlead','manager','founder'],situation:['group','hybrid'],context:['professional','leader'],challenge:['innovation','error'],tip:'Safe-to-fail probe: 1 zespÃ³Å‚, 4 tygodnie, jasne metryki. Pre-mortem: co moÅ¼e pÃ³jÅ›Ä‡ nie tak?',fluxWhy:'EXPERIMENT: PilotaÅ¼ = safe-to-fail probe. 1 zespÃ³Å‚ testuje, caÅ‚a organizacja uczy siÄ™ z wyniku.'},
  {title:'MVP produktu w start-upie',desc:'Founder decyduje o pivocie na podstawie danych z 2 tygodni, nie 2 kwartaÅ‚Ã³w.',area:['experiment','fast'],industry:['startup'],role:['founder','teamlead'],situation:['hybrid','crisis'],context:['professional'],challenge:['innovation','decision','speed'],tip:'Experiment Outcome Log: hipoteza â†’ test â†’ wynik â†’ wniosek â†’ nastÄ™pny krok. Nie pivot bez danych.',fluxWhy:'EXPERIMENT: MVP to eksperyment z ograniczonym ryzykiem. FAST: 2 tygodnie danych > 2 kwartaÅ‚y opinii.'},
  // EXPERIMENT - personal
  {title:'Test nowego hobby',desc:'RC Cars czy fotografia? Nie musisz wybieraÄ‡ od razu â€” testuj.',area:['experiment'],industry:[],role:[],situation:['offline'],context:['hobby'],challenge:['innovation'],tip:'2 tygodnie: 1 hobby. Notuj flow state (skala 1-10). Po miesiÄ…cu porÃ³wnaj.',fluxWhy:'EXPERIMENT: Nie wybieraj â€” testuj. 2 tygodnie na hobby z pomiarem flow state to kontrolowany test.'},
  {title:'Eksperyment z rutynÄ… porannÄ…',desc:'WstaÄ‡ o 5:30 i Ä‡wiczyÄ‡? Albo medytacja? Test 21 dni.',area:['experiment'],industry:[],role:[],situation:['one2one'],context:['health'],challenge:['innovation'],tip:'Hypothesis Builder: "JeÅ›li wstanÄ™ o 5:30 to energia do 14:00 wzroÅ›nie". Mierz przez 3 tygodnie.',fluxWhy:'EXPERIMENT: Rutyna poranna to hipoteza do sprawdzenia â€” 21 dni pomiaru energii da odpowiedÅº.'},
  {title:'Nowy format randki z OlÄ…',desc:'Zamiast kina â€” escape room, gotowanie razem, wspÃ³lny projekt? Testuj co daje wiÄ™cej.',area:['experiment'],industry:[],role:[],situation:['one2one','offline'],context:['husband'],challenge:['innovation'],tip:'1 nowe doÅ›wiadczenie/miesiÄ…c. Refleksja: co daÅ‚o wiÄ™cej bliskoÅ›ci? Konto emocjonalne: + czy -?',fluxWhy:'EXPERIMENT: Relacja to Å¼ywy organizm â€” nowe formy randek testujÄ… co generuje wiÄ™cej bliskoÅ›ci.'},
];

// ===== RESEARCH =====
const RESEARCH=[
  {area:'fast',authors:'Eisenhardt, K.M.',year:1989,title:'Making Fast Strategic Decisions in High-Velocity Environments',finding:'Szybkie zespoÅ‚y decyzyjne uÅ¼ywajÄ… wiÄ™cej informacji i tworzÄ… wiÄ™cej alternatyw niÅ¼ wolne.',type:'Badanie empiryczne',src:'https://www.jstor.org/stable/256434'},
  {area:'fast',authors:'Werder, K. et al.',year:2022,title:'IT capability â†’ organizational agility (meta-analysis)',finding:'ZdolnoÅ›ci IT wspierajÄ… zwinnoÅ›Ä‡ w wymiarze sensing i responding.',type:'Meta-analiza',src:'https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0268761'},
  {area:'fast',authors:'CzurÅ‚owska, M.',year:2024,title:'Agile w praktyce â€” wpÅ‚yw na komunikacjÄ™ i adaptacjÄ™',finding:'WdroÅ¼enie Agile poprawia wspÃ³Å‚pracÄ™ i tempo adaptacji.',type:'Badanie',src:null},
  {area:'liquid',authors:'Frazier, M.L. et al.',year:2017,title:'Psychological Safety: A Meta-Analytic Review',finding:'PS wiÄ…Å¼e siÄ™ z lepszÄ… efektywnoÅ›ciÄ…, dzieleniem wiedzy i zachowaniami obywatelskimi.',type:'Meta-analiza',src:'https://onlinelibrary.wiley.com/doi/abs/10.1111/peps.12183'},
  {area:'liquid',authors:'Edmondson, A.C.',year:1999,title:'Psychological safety and learning behavior in work teams',finding:'Klimat ryzyka interpersonalnego uÅ‚atwia uczenie siÄ™ zespoÅ‚owe.',type:'Badanie empiryczne',src:'https://journals.sagepub.com/doi/10.2307/2666999'},
  {area:'liquid',authors:'Jin, X.',year:2024,title:'Psychological Safety i innowacyjnoÅ›Ä‡ pracownikÃ³w',finding:'Komunikacja jest mechanizmem Å‚Ä…czÄ…cym PS z efektywnoÅ›ciÄ… innowacyjnÄ….',type:'Badanie',src:null},
  {area:'liquid',authors:'Santana, R. et al.',year:2025,title:'Psychological safety w Å›rodowisku IT',finding:'PS = warunek wspÃ³Å‚pracy, uczenia siÄ™ i dostosowania do zmian w zespoÅ‚ach cross-funkcyjnych.',type:'PrzeglÄ…d systematyczny',src:null},
  {area:'liquid',authors:'Dickel, D. et al.',year:2026,title:'PS, wspÃ³Å‚praca i dynamic capabilities',finding:'PS â†’ wspÃ³Å‚praca â†’ dynamic capabilities. RÃ³Å¼nice kulturowe (Brazylia vs Niemcy).',type:'Badanie porÃ³wnawcze',src:null},
  {area:'unlearn',authors:'Brynjolfsson, E. et al.',year:2023,title:'Generative AI at Work (NBER)',finding:'AI w obsÅ‚udze klienta: +14% produktywnoÅ›Ä‡, najwiÄ™kszy zysk dla najmniej doÅ›wiadczonych.',type:'Badanie NBER',src:'https://www.nber.org/papers/w31161'},
  {area:'unlearn',authors:'Sisk, V.F. et al.',year:2018,title:'Growth mindset meta-analysis',finding:'ZwiÄ…zek growth mindset z wynikami istotny ale niewielki. Kontekst > interwencja.',type:'Meta-analiza',src:'https://journals.sagepub.com/doi/10.1177/0956797617739704'},
  {area:'experiment',authors:'van Dyck, C. et al.',year:2005,title:'Organizational Error Management Culture',finding:'Kultura zarzÄ…dzania bÅ‚Ä™dami (nie unikania) â†’ lepsza wydajnoÅ›Ä‡. Otwarta komunikacja o bÅ‚Ä™dach kluczowa.',type:'Badanie empiryczne',src:'https://pubmed.ncbi.nlm.nih.gov/16316276/'}
];

// ===== TOOLS =====
const TOOLS=[
  {area:'fast',name:'Decyzja w 15 minut',type:'Checklista',desc:'Co wiem â†’ czego nie wiem â†’ konsekwencje bezczynnoÅ›ci â†’ decyzja.',use:'Przed kaÅ¼dÄ… decyzjÄ… czekajÄ…cÄ… >24h.'},
  {area:'fast',name:'2-min Decision Log',type:'Mikro-nawyk',desc:'Po decyzji: 2 min na kontekst, opcje, rationale. Buduje bazÄ™ wiedzy.',use:'Codziennie.'},
  {area:'fast',name:'Signal Scanning Ritual',type:'RytuaÅ‚',desc:'5 sygnaÅ‚Ã³w/tydzieÅ„ z rynku: co to znaczy dla nas?',use:'PoniedziaÅ‚kowy stand-up.'},
  {area:'fast',name:'Decision Tempo Tracker',type:'Metryka',desc:'Od identyfikacji problemu do dziaÅ‚ania â€” ile dni? Benchmark.',use:'MiesiÄ™czny przeglÄ…d.'},
  {area:'liquid',name:'Psychological Safety Radar',type:'Diagnostyka',desc:'7 pytaÅ„ Edmondson + 3 o przepÅ‚yw wiedzy. Skala 1-5.',use:'Co kwartaÅ‚.'},
  {area:'liquid',name:'Collaboration Flow Map',type:'Canvas',desc:'Kto â†’ komu â†’ co â†’ jak czÄ™sto â†’ wartoÅ›Ä‡. Bottlenecki.',use:'Raz na kwartaÅ‚.'},
  {area:'liquid',name:'Cross-Team Sync Checklist',type:'Checklista',desc:'Agenda, decyzje, action items, ownership, deadline.',use:'KaÅ¼de spotkanie cross-fun.'},
  {area:'liquid',name:'Liquid Collaboration Canvas',type:'Canvas',desc:'Role â†’ kanaÅ‚y â†’ czÄ™stotliwoÅ›Ä‡ â†’ jakoÅ›Ä‡ w zespoÅ‚ach.',use:'Sprint retrospective.'},
  {area:'liquid',name:'Team Dynamics Diagnostic',type:'Diagnostyka',desc:'PS + wspÃ³Å‚praca â†’ dynamic capabilities. Benchmarki Dickel 2026.',use:'Kwartalna diagnoza.'},
  {area:'unlearn',name:'Adaptive Learning Loop',type:'Framework',desc:'DziaÅ‚aj â†’ Obserwuj â†’ Reflektuj â†’ Adaptuj. 4 pytania.',use:'Po kaÅ¼dym sprincie/projekcie.'},
  {area:'unlearn',name:'Skill Gap Analyzer',type:'Diagnostyka',desc:'Obecne vs wymagane umiejÄ™tnoÅ›ci. Plan 30/60/90 dni.',use:'Kwartalnie, przed transformacjÄ….'},
  {area:'unlearn',name:'Learning Cycle Canvas',type:'Canvas',desc:'Co siÄ™ wydarzyÅ‚o â†’ sprawdziÅ‚o â†’ nie dziaÅ‚aÅ‚o â†’ zmieniamy â†’ mierzymy.',use:'Retrospektywy, post-mortemy.'},
  {area:'unlearn',name:'AI Prompt Pack',type:'Prompt Pack',desc:'Podsumowanie spotkania, analiza sprzedaÅ¼y, brainstorm, warianty.',use:'Codziennie z AI.'},
  {area:'experiment',name:'Hypothesis Builder',type:'Framework',desc:'JeÅ›li [X] to [Y] poniewaÅ¼ [Z]. Metryka + timeline.',use:'Przed kaÅ¼dym eksperymentem.'},
  {area:'experiment',name:'Experiment Outcome Log',type:'Rejestr',desc:'Hipoteza â†’ test â†’ wynik â†’ wniosek â†’ next step.',use:'Po kaÅ¼dym eksperymencie.'},
  {area:'experiment',name:'Experiment Design Kit',type:'Framework',desc:'MVP canvas, A/B template, pilot protocol, failure pre-mortem.',use:'Warsztaty innowacyjne.'},
];

// ===== MEGAWORLDS (Hatalska 2025) =====
const MEGAWORLDS={
  spoleczny:    {name:'PrzeobraÅ¼enia SpoÅ‚eczne', color:'#6366f1', icon:'ğŸ‘¥'},
  ai:           {name:'Åšwiat AI',                color:'#3b82f6', icon:'ğŸ¤–'},
  lustrzany:    {name:'Åšwiat Lustrzany',         color:'#a78bfa', icon:'ğŸª'},
  zrownowazony: {name:'ZrÃ³wnowaÅ¼ony Åšwiat',      color:'#22c55e', icon:'ğŸŒ'},
  zdrowie:      {name:'Kryzys Zdrowotny',        color:'#ef4444', icon:'ğŸ¥'},
  wojny:        {name:'Åšwiat Wojen',             color:'#64748b', icon:'âš”ï¸'}
};

// ===== TRENDS (Mapa TrendÃ³w Hatalska 2025) =====
const TRENDS=[
  // === ÅšWIAT PRZEOBRAÅ»EÅƒ SPOÅECZNYCH ===
  {name:'Polaryzacja',mw:'spoleczny',ring:'now',flux:['unlearn'],hr:true,desc:'PogÅ‚Ä™bianie podziaÅ‚Ã³w spoÅ‚ecznych, politycznych i kulturowych.'},
  {name:'NierÃ³wnoÅ›ci spoÅ‚eczne',mw:'spoleczny',ring:'now',flux:['liquid'],hr:true,desc:'NarastajÄ…ce nierÃ³wnoÅ›ci socjoekonomiczne widoczne globalnie.'},
  {name:'Kryzys demokracji',mw:'spoleczny',ring:'now',flux:['unlearn','liquid'],hr:false,desc:'Spadek zaufania obywateli, popularnoÅ›Ä‡ ruchÃ³w autorytarnych i populistycznych.'},
  {name:'Wojny miÄ™dzypokoleniowe',mw:'spoleczny',ring:'now',flux:['liquid','unlearn'],hr:true,desc:'NapiÄ™cia miÄ™dzy pokoleniami w kwestii wartoÅ›ci, pracy i zasobÃ³w.'},
  {name:'Dyktat produktywnoÅ›ci',mw:'spoleczny',ring:'now',flux:['fast','unlearn'],hr:true,desc:'ProduktywnoÅ›Ä‡ jako priorytet kosztem dobrostanu. AI wspiera automatyzacjÄ™ rutyn.'},
  {name:'PÅ‚ynnoÅ›Ä‡ toÅ¼samoÅ›ci',mw:'spoleczny',ring:'now',flux:['liquid','unlearn'],hr:false,desc:'Rozmywanie tradycyjnych rÃ³l, toÅ¼samoÅ›ci i granic spoÅ‚ecznych.'},
  {name:'Posteuropocentryzm',mw:'spoleczny',ring:'now',flux:['unlearn'],hr:false,desc:'PrzesuniÄ™cie centrum kulturowego i ekonomicznego poza EuropÄ™.'},
  {name:'StarzejÄ…ce siÄ™ spoÅ‚eczeÅ„stwo',mw:'spoleczny',ring:'new',flux:['liquid','unlearn'],hr:true,desc:'RosnÄ…cy odsetek ludzi 65+ zmienia rynek pracy i opiekÄ™ zdrowotnÄ….'},
  {name:'Depopulacja',mw:'spoleczny',ring:'new',flux:['liquid'],hr:false,desc:'Spadek liczby ludnoÅ›ci w wielu krajach, zmiany regulacyjne i spoÅ‚eczne.'},
  {name:'Nowe modele rodziny',mw:'spoleczny',ring:'next',flux:['unlearn'],hr:false,desc:'Ewolucja struktury rodziny wykraczajÄ…ca poza tradycyjne modele.'},
  {name:'Rozpad paÅ„stwowoÅ›ci',mw:'spoleczny',ring:'next',flux:['liquid'],hr:false,desc:'NarastajÄ…ce napiÄ™cia geopolityczne podwaÅ¼ajÄ…ce instytucje paÅ„stw.'},
  // === ÅšWIAT AI ===
  {name:'Algokracja',mw:'ai',ring:'now',flux:['fast','unlearn'],hr:true,desc:'RosnÄ…cy wpÅ‚yw algorytmÃ³w na decyzje, procesy i polaryzacjÄ™ spoÅ‚ecznÄ….'},
  {name:'Bezrobocie technologiczne',mw:'ai',ring:'now',flux:['fast','unlearn'],hr:true,desc:'ZastÄ™powanie pracownikÃ³w przez AI w usÅ‚ugach, produkcji i logistyce.'},
  {name:'Ekonomia twÃ³rcÃ³w',mw:'ai',ring:'now',flux:['liquid','experiment'],hr:false,desc:'Demokratyzacja kompetencji twÃ³rczych dziÄ™ki generatywnej AI.'},
  {name:'NiestabilnoÅ›Ä‡ rynku pracy',mw:'ai',ring:'now',flux:['fast','unlearn'],hr:true,desc:'Automatyzacja i AI transformujÄ… rynek pracy â€” reskilling i upskilling.'},
  {name:'Etyczna AI',mw:'ai',ring:'new',flux:['unlearn','experiment'],hr:false,desc:'Budowanie AI zgodnej z wartoÅ›ciami etycznymi, wolnej od uprzedzeÅ„.'},
  {name:'Citizen Developer Era',mw:'ai',ring:'new',flux:['liquid','experiment'],hr:false,desc:'Demokratyzacja tworzenia oprogramowania dziÄ™ki no-code i AI-driven development.'},
  {name:'Human-like AI',mw:'ai',ring:'new',flux:['unlearn','experiment'],hr:false,desc:'AI coraz bardziej przypominajÄ…ca czÅ‚owieka w myÅ›leniu i interakcji.'},
  {name:'Inteligencja kolektywna',mw:'ai',ring:'new',flux:['liquid'],hr:false,desc:'Synergia ludzkiej intuicji i zdolnoÅ›ci AI do analizy zÅ‚oÅ¼onych problemÃ³w.'},
  {name:'AutonomicznoÅ›Ä‡ 2.0',mw:'ai',ring:'next',flux:['fast','experiment'],hr:false,desc:'Systemy AI zdolne do samodzielnego podejmowania decyzji i adaptacji.'},
  {name:'OgÃ³lna sztuczna inteligencja (AGI)',mw:'ai',ring:'beyond',flux:['fast','experiment'],hr:false,desc:'AI o zdolnoÅ›ciach poznawczych porÃ³wnywalnych z ludzkim umysÅ‚em.'},
  {name:'Sztuczna superinteligencja',mw:'ai',ring:'beyond',flux:['experiment'],hr:false,desc:'AI przewyÅ¼szajÄ…ca ludzkie zdolnoÅ›ci we wszystkich domenach.'},
  // === ÅšWIAT LUSTRZANY ===
  {name:'Chroniczinie online',mw:'lustrzany',ring:'now',flux:['unlearn'],hr:true,desc:'Izolacja spoÅ‚eczna, spadek empatii, zaburzenia zdrowia psychicznego.'},
  {name:'ZnieksztaÅ‚cona rzeczywistoÅ›Ä‡',mw:'lustrzany',ring:'now',flux:['unlearn'],hr:false,desc:'Manipulacja informacjÄ…, deepfakes, zaburzenie granicy prawda/faÅ‚sz.'},
  {name:'Antytech',mw:'lustrzany',ring:'now',flux:['unlearn'],hr:true,desc:'Sprzeciw wobec wpÅ‚ywu tech-gigantÃ³w. Åšwiadome ograniczanie technologii.'},
  {name:'Analfabetyzm funkcjonalny',mw:'lustrzany',ring:'now',flux:['unlearn','liquid'],hr:true,desc:'ObniÅ¼enie zdolnoÅ›ci czytania ze zrozumieniem i formuÅ‚owania myÅ›li.'},
  {name:'Antynauka',mw:'lustrzany',ring:'now',flux:['unlearn'],hr:true,desc:'Kwestionowanie nauki, rozprzestrzenianie teorii spiskowych i fake newsÃ³w.'},
  {name:'Datafikacja spoÅ‚eczeÅ„stwa',mw:'lustrzany',ring:'new',flux:['fast','liquid'],hr:false,desc:'PrzeksztaÅ‚canie Å¼ycia spoÅ‚ecznego w dane â€” algorytmy i inwigiliacja.'},
  {name:'Syntetyczna rzeczywistoÅ›Ä‡',mw:'lustrzany',ring:'new',flux:['experiment'],hr:false,desc:'Generowane przez AI Å›rodowiska zastÄ™pujÄ…ce doÅ›wiadczenie fizyczne.'},
  {name:'SpoÅ‚eczeÅ„stwo hybrydowe',mw:'lustrzany',ring:'new',flux:['liquid'],hr:false,desc:'Å»ycie jednoczeÅ›nie w Å›wiecie fizycznym i cyfrowym jako norma.'},
  {name:'Internet istot',mw:'lustrzany',ring:'new',flux:['experiment','liquid'],hr:false,desc:'Rozszerzenie IoT na organizmy Å¼ywe â€” zbieranie i analiza danych biologicznych.'},
  // === ZRÃ“WNOWAÅ»ONY ÅšWIAT ===
  {name:'Dekarbonizacja',mw:'zrownowazony',ring:'now',flux:['experiment','fast'],hr:false,desc:'Redukcja emisji COâ‚‚ i zastosowanie innowacyjnych technologii klimatycznych.'},
  {name:'HiperlokalnoÅ›Ä‡',mw:'zrownowazony',ring:'now',flux:['liquid'],hr:false,desc:'Lokalna produkcja, krÃ³tkie Å‚aÅ„cuchy dostaw, budowanie sieci lokalnych.'},
  {name:'Decentralizacja',mw:'zrownowazony',ring:'now',flux:['liquid','experiment'],hr:false,desc:'ZwiÄ™kszenie odpornoÅ›ci systemÃ³w przez rozproszenie zasobÃ³w i wÅ‚adzy.'},
  {name:'Regeneratywne miasta',mw:'zrownowazony',ring:'new',flux:['experiment'],hr:false,desc:'Miasta aktywnie odbudowujÄ…ce ekosystemy, nie tylko minimalizujÄ…ce szkody.'},
  {name:'Rezyliencja energetyczna',mw:'zrownowazony',ring:'new',flux:['experiment','fast'],hr:false,desc:'OdpornoÅ›Ä‡ systemÃ³w energetycznych na kryzysy i zakÅ‚Ã³cenia.'},
  {name:'Nowe materiaÅ‚y',mw:'zrownowazony',ring:'next',flux:['experiment'],hr:false,desc:'BiomateriaÅ‚y, materiaÅ‚y postkrzemowe, programowalne substancje.'},
  {name:'Biocomputing',mw:'zrownowazony',ring:'beyond',flux:['experiment'],hr:false,desc:'Przetwarzanie danych na strukturach biologicznych â€” DNA, biaÅ‚ka, komÃ³rki.'},
  // === ÅšWIAT KRYZYSÃ“W ZDROWOTNYCH ===
  {name:'Kryzys zdrowia psychicznego',mw:'zdrowie',ring:'now',flux:['unlearn','liquid'],hr:true,desc:'Stale nasilajÄ…cy siÄ™ stres, lÄ™ki, depresja â€” szczegÃ³lnie wÅ›rÃ³d mÅ‚odych.'},
  {name:'SpoÅ‚eczeÅ„stwo wypalenia',mw:'zdrowie',ring:'now',flux:['unlearn','fast'],hr:true,desc:'Chroniczny stres i przepracowanie jako norma spoÅ‚eczna.'},
  {name:'Osamotnienie',mw:'zdrowie',ring:'now',flux:['liquid','unlearn'],hr:true,desc:'Epidemia samotnoÅ›ci mimo hiperÅ‚Ä…cznoÅ›ci cyfrowej.'},
  {name:'Dehumanizacja relacji',mw:'zdrowie',ring:'now',flux:['liquid','unlearn'],hr:false,desc:'Spadek umiejÄ™tnoÅ›ci komunikacyjnych, izolacja i zanik empatii.'},
  {name:'Dobrostan',mw:'zdrowie',ring:'now',flux:['liquid','experiment'],hr:false,desc:'PodejÅ›cie holistyczne do zdrowia â€” fizyczne, psychiczne, spoÅ‚eczne.'},
  {name:'SpoÅ‚eczeÅ„stwo uzaleÅ¼nionych',mw:'zdrowie',ring:'now',flux:['unlearn'],hr:true,desc:'UzaleÅ¼nienia od technologii, substancji, mediÃ³w spoÅ‚ecznoÅ›ciowych.'},
  {name:'LekoopornoÅ›Ä‡',mw:'zdrowie',ring:'new',flux:['experiment'],hr:false,desc:'OpornoÅ›Ä‡ bakterii na antybiotyki jako kolejny globalny kryzys zdrowotny.'},
  {name:'Medycyna regeneratywna',mw:'zdrowie',ring:'new',flux:['experiment'],hr:false,desc:'Terapie oparte na regeneracji komÃ³rek, tkanek i narzÄ…dÃ³w.'},
  {name:'Epidemia chorÃ³b mÃ³zgu',mw:'zdrowie',ring:'next',flux:['experiment','unlearn'],hr:false,desc:'Wzrost chorÃ³b neurodegeneracyjnych: Alzheimer, Parkinson, ALS.'},
  {name:'Wellaging',mw:'zdrowie',ring:'next',flux:['experiment'],hr:false,desc:'OpÃ³Åºnianie, hamowanie lub odwracanie procesÃ³w starzenia.'},
  {name:'Eliminacja staroÅ›ci',mw:'zdrowie',ring:'next',flux:['experiment'],hr:false,desc:'DÄ…Å¼enie naukowe do spowolnienia biologicznego starzenia.'},
  // === ÅšWIAT WOJEN ===
  {name:'Erozja Å‚adu jednobiegunowego',mw:'wojny',ring:'now',flux:['fast','liquid'],hr:false,desc:'Spadek zaufania do instytucji, wielobiegunowy i niestabilny Å›wiat.'},
  {name:'Imperializm technologiczny',mw:'wojny',ring:'now',flux:['fast'],hr:false,desc:'PaÅ„stwa z przewagÄ… AI i robotyki uzyskujÄ… globalnÄ… dominacjÄ™.'},
  {name:'Militaryzacja AI',mw:'wojny',ring:'now',flux:['fast','experiment'],hr:false,desc:'Automatyzacja procesÃ³w decyzyjnych w dziaÅ‚aniach zbrojnych.'},
  {name:'Deglobalizacja',mw:'wojny',ring:'now',flux:['liquid','unlearn'],hr:false,desc:'OsÅ‚abienie integracji globalnej â€” napiÄ™cia handlowe i geopolityczne.'},
  {name:'Kryzys wodny',mw:'wojny',ring:'now',flux:['fast','experiment'],hr:false,desc:'Eskalacja niedoboru zasobÃ³w wodnych miÄ™dzy paÅ„stwami.'},
  {name:'Wojny kognitywne',mw:'wojny',ring:'now',flux:['unlearn'],hr:false,desc:'Manipulacja percepcjÄ… i przekonaniami jako broÅ„ wspÃ³Å‚czesna.'},
  {name:'Era nadmiaru danych',mw:'wojny',ring:'now',flux:['fast','unlearn'],hr:false,desc:'Lawinowy wzrost danych i trudnoÅ›ci z ich przetwarzaniem i selekcjÄ….'},
  {name:'WyÅ›cig kosmiczny 2.0',mw:'wojny',ring:'next',flux:['experiment','fast'],hr:false,desc:'Rywalizacja o zasoby i dominacjÄ™ w przestrzeni kosmicznej.'},
  {name:'Geopolityka kosmosu',mw:'wojny',ring:'next',flux:['fast'],hr:false,desc:'Regulacje orbitalne, cyberzagroÅ¼enia satelitarne, broÅ„ antysatelitarna.'},
  // === CROSS-DOMAIN (pojawiajÄ… siÄ™ w wielu megaÅ›wiatach) ===
  {name:'AI-fobia',mw:'ai',ring:'now',flux:['unlearn'],hr:true,desc:'LÄ™k przed AI, utratÄ… kontroli, FOBO â€” Fear of Becoming Obsolete.'},
  {name:'Korpokracja',mw:'spoleczny',ring:'now',flux:['liquid','fast'],hr:false,desc:'Przejmowanie wÅ‚adzy przez korporacje technologiczne kosztem demokracji.'},
  {name:'Migracje',mw:'wojny',ring:'now',flux:['liquid','unlearn'],hr:false,desc:'ZÅ‚oÅ¼onoÅ›Ä‡ migracji wymagajÄ…ca strategicznego podejÅ›cia i adaptacji.'},
  {name:'Biologia syntetyczna',mw:'zrownowazony',ring:'next',flux:['experiment'],hr:false,desc:'Projektowanie i modyfikowanie organizmÃ³w biologicznych na zamÃ³wienie.'},
  {name:'Lab Grown',mw:'zrownowazony',ring:'next',flux:['experiment'],hr:false,desc:'Produkty wytwarzane w laboratorium â€” miÄ™so, materiaÅ‚y, leki.'},
  {name:'CzÅ‚owiek+',mw:'zdrowie',ring:'new',flux:['experiment','unlearn'],hr:false,desc:'Polepszanie ludzkiego ciaÅ‚a i umysÅ‚u przez technologiÄ™ i genetykÄ™.'},
  {name:'Rewolucja neurotechnologiczna',mw:'zdrowie',ring:'beyond',flux:['experiment'],hr:false,desc:'Interfejsy mÃ³zg-maszyna, implanty neuronowe, terapie neuromodulacyjne.'},
  {name:'Prawa istot pozaludzkich',mw:'zrownowazony',ring:'beyond',flux:['unlearn','experiment'],hr:false,desc:'Regulacje prawne dla AI i zwierzÄ…t, redefinicja podmiotowoÅ›ci.'}
];

// ===== STATE =====
let filters={area:'all',industry:'all',role:'all',situation:'all',context:'all',challenge:'all'};
let trendFilter='all',resFilter='all',mwFilter='all',hrOnly=false;
let tooltipTimer=null;

// ===== FLUX BADGE (reusable clickable badge) =====
function fluxBadge(area,opts={}){
  const {size='sm',showName=false,clickAction='tooltip'}=opts;
  const d=FLUX[area],c=CC[area];
  const sz=size==='md'?'text-sm px-3 py-1':'text-xs px-2 py-0.5';
  const label=showName?d.letter+' â€” '+d.name:d.letter;
  let action;
  if(clickAction==='detail')action="showDetail('"+area+"')";
  else if(clickAction==='filter')action="nav('explore');filters.area='"+area+"';renderExplore()";
  else action="event.stopPropagation();showMiniTooltip(event,'"+area+"')";
  return '<span class="'+sz+' rounded-full '+c.bg+' '+c.t+' font-bold cursor-pointer hover:brightness-125 transition-all" onclick="'+action+'" title="'+d.name+': '+d.full+'">'+label+'</span>';
}

// ===== WHEEL CLOUD TOOLTIP =====
function showWheelTooltip(area){
  clearTimeout(tooltipTimer);
  const tt=document.getElementById('flux-tooltip');
  if(!tt)return;
  const d=FLUX[area],c=CC[area];
  const count=SCENARIOS.filter(s=>{
    if(!s.area.includes(area))return false;
    if(filters.industry!=='all'&&!s.industry.includes(filters.industry)&&s.industry.length>0)return false;
    if(filters.role!=='all'&&!s.role.includes(filters.role)&&s.role.length>0)return false;
    return true;
  }).length;
  const relTrends=TRENDS.filter(t=>t.flux&&t.flux.includes(area)).slice(0,5);
  tt.innerHTML=`
    <div class="flex items-center gap-2 mb-2">
      <span class="w-10 h-10 rounded-lg ${c.bg} flex items-center justify-center"><span class="${c.t} font-black text-xl">${d.letter}</span></span>
      <div><h4 class="${c.t} font-bold text-sm">${d.name}</h4><p class="text-slate-500 text-xs">${d.full}</p></div>
    </div>
    <p class="text-xs text-slate-400 mb-3">${d.def.substring(0,120)}...</p>
    <div class="flex items-center gap-2 mb-2">
      <span class="text-xs px-2 py-0.5 rounded-full ${c.bg} ${c.t} cursor-pointer hover:brightness-125" onclick="hideWheelTooltip();nav('explore');filters.area='${area}';renderExplore()">${count} scenariuszy â†’</span>
    </div>
    <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">Antywzorce</p>
    <div class="space-y-0.5 mb-3">${d.anti.slice(0,2).map(a=>'<p class="text-xs text-red-400/70">âœ• '+a.split('â€”')[0].trim()+'</p>').join('')}</div>
    ${relTrends.length?`<p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">Trendy 2025</p>
    <div class="flex flex-wrap gap-1 mb-2">${relTrends.slice(0,4).map(t=>{
      const mw=MEGAWORLDS[t.mw];
      return '<span class="text-[10px] px-1.5 py-0.5 rounded" style="background:'+mw.color+'20;color:'+mw.color+'">'+(t.hr?'âš¡ ':'')+t.name+'</span>';
    }).join('')}</div>`:''}
    <p class="text-xs text-slate-500 mt-1 italic cursor-pointer" onclick="hideWheelTooltip();showDetail('${area}')">SzczegÃ³Å‚y â†’</p>`;
  tt.className='flux-tooltip tt-'+area;
  // Dynamic positioning based on wheel quadrant center
  const svg=document.querySelector('#view-home svg');
  if(svg){
    const sr=svg.getBoundingClientRect();
    const cx=sr.left+sr.width/2,cy=sr.top+sr.height/2;
    const qr=sr.width/4; // quadrant radius
    const vw=document.documentElement.clientWidth;
    const vh=document.documentElement.clientHeight;
    let tx,ty;
    if(area==='fast'){tx=cx+qr/2;ty=cy-qr*1.5;} // top-right â†’ tooltip right of center
    else if(area==='liquid'){tx=cx+qr/2;ty=cy+qr/2;} // bottom-right
    else if(area==='unlearn'){tx=cx-qr*1.5-160;ty=cy+qr/2;} // bottom-left
    else{tx=cx-qr*1.5-160;ty=cy-qr*1.5;} // experiment top-left
    // Clamp to viewport
    tx=Math.max(8,Math.min(tx,vw-328));
    ty=Math.max(60,Math.min(ty,vh-380));
    Object.assign(tt.style,{top:ty+'px',left:tx+'px',bottom:'',right:''});
  }
  requestAnimationFrame(()=>tt.classList.add('visible'));
}
function hideWheelTooltip(){
  tooltipTimer=setTimeout(()=>{const tt=document.getElementById('flux-tooltip');if(tt)tt.classList.remove('visible');},200);
}
function keepWheelTooltip(){clearTimeout(tooltipTimer);}

// ===== MINI TOOLTIP (for inline badges) =====
function showMiniTooltip(ev,area){
  ev.stopPropagation();
  document.getElementById('mini-tooltip')?.remove();
  const d=FLUX[area],c=CC[area];
  const div=document.createElement('div');
  div.id='mini-tooltip';
  div.className='fixed z-[10002] max-w-xs p-3 bg-dark-900/95 backdrop-blur-md border border-dark-700 rounded-xl shadow-2xl';
  div.innerHTML=`
    <div class="flex items-center gap-2 mb-1"><span class="${c.t} font-black text-lg">${d.letter}</span><span class="${c.t} font-bold text-sm">${d.name}</span></div>
    <p class="text-xs text-slate-400 mb-2">${d.full}</p>
    <p class="text-xs text-slate-500 mb-2">${d.def.substring(0,100)}...</p>
    <button class="text-xs ${c.t} hover:underline" onclick="showDetail('${area}');document.getElementById('mini-tooltip')?.remove()">SzczegÃ³Å‚y â†’</button>`;
  const rect=ev.target.getBoundingClientRect();
  div.style.left=Math.min(rect.left,window.innerWidth-280)+'px';
  div.style.top=(rect.bottom+8)+'px';
  document.body.appendChild(div);
  setTimeout(()=>{document.addEventListener('click',function h(e){if(!div.contains(e.target)){div.remove();document.removeEventListener('click',h)}})},10);
}

// ===== WHEEL TREND DOTS (Home view) =====
function renderWheelTrendDots(){
  const g=document.getElementById('wheel-trend-dots');if(!g)return;
  const cx=400,cy=400;
  // Quadrant angle ranges (center angles for placing dots)
  const quadrants={fast:{startA:-80,endA:-10,r:[100,170,230]},liquid:{startA:10,endA:80,r:[100,170,230]},unlearn:{startA:100,endA:170,r:[100,170,230]},experiment:{startA:190,endA:260,r:[100,170,230]}};
  let h='';
  ['fast','liquid','unlearn','experiment'].forEach(area=>{
    const hrTrends=TRENDS.filter(t=>t.flux&&t.flux.includes(area)&&t.hr);
    const topTrends=hrTrends.slice(0,6);
    const q=quadrants[area];
    const spread=q.endA-q.startA;
    topTrends.forEach((t,i)=>{
      const mw=MEGAWORLDS[t.mw];
      const rIdx=Math.floor(i/2);
      const r=q.r[Math.min(rIdx,q.r.length-1)];
      const angleOffset=spread/(Math.min(topTrends.length,6)+1)*(i+1);
      const angle=(q.startA+angleOffset)*Math.PI/180;
      const x=cx+r*Math.cos(angle),y=cy+r*Math.sin(angle);
      const dotR=t.ring==='now'?4:3;
      const op=t.ring==='now'?.5:t.ring==='new'?.35:.2;
      h+=`<g class="cursor-pointer" onclick="event.stopPropagation();nav('trends');trendFilter='${area}';renderTrends()">
        <circle cx="${x}" cy="${y}" r="${dotR}" fill="${mw.color}" opacity="${op}"/>
        <text x="${x}" y="${y-dotR-3}" text-anchor="middle" fill="${mw.color}" font-size="5" opacity="${op*.8}" font-weight="500">${t.name.length>14?t.name.substring(0,12)+'â€¦':t.name}</text>
      </g>`;
    });
  });
  g.innerHTML=h;
}

// ===== NAVIGATION =====
function nav(v){
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(l=>{l.classList.remove('active');l.style.removeProperty('color')});
  const el=document.getElementById('view-'+v);
  if(el)el.classList.add('active');
  document.querySelector(`.nav-link[data-v="${v}"]`)?.classList.add('active');
  if(v==='explore')renderExplore();
  if(v==='trends')renderTrends();
  if(v==='research')renderResearch();
  if(v==='tools')renderTools();
  if(v==='modules')renderModulesView();
  if(v==='diagnostic')renderDiagnosticView();
  if(v==='actionplan')renderActionPlanView();
  if(v==='trainer')renderTrainerView();
  if(isModuleOn('progress'))trackViewVisit(v);
  window.scrollTo({top:0,behavior:'smooth'});
}
function toggleMobile(){
  document.querySelector('.hamburger').classList.toggle('open');
  document.querySelector('.mobile-menu').classList.toggle('open');
}

// ===== DETAIL VIEW =====
let curArea=null,curTab='overview';
function showDetail(a){
  curArea=a;curTab='overview';const d=FLUX[a],c=CC[a];
  document.getElementById('detail-header').innerHTML=`
    <div class="flex items-center gap-3"><div class="w-12 h-12 rounded-xl ${c.bg} flex items-center justify-center"><span class="${c.t} font-black text-2xl">${d.letter}</span></div>
    <div><h2 class="text-2xl font-black ${c.t}">${d.name}</h2><p class="text-slate-400 text-sm">${d.full}</p></div></div>
    <p class="mt-3 text-sm text-slate-300 bg-dark-900 rounded-lg p-3 border ${c.b}">${d.def}</p>`;
  const tabs=['overview','research','industries','tools'];
  const labels=['PrzeglÄ…d','Badania','Scenariusze','NarzÄ™dzia'];
  document.getElementById('detail-tabs').innerHTML=tabs.map((t,i)=>`<button class="tab-btn pb-2 text-xs font-medium ${t==='overview'?c.t+' active':'text-slate-500'}" onclick="curTab='${t}';renderDetail()" style="border-bottom-color:${t==='overview'?d.color:'transparent'}">${labels[i]}</button>`).join('');
  renderDetail();nav('detail');
}
function renderDetail(){
  const d=FLUX[curArea],c=CC[curArea],el=document.getElementById('detail-content');
  document.querySelectorAll('.tab-btn').forEach(b=>{b.classList.remove('active',c.t);b.classList.add('text-slate-500');b.style.borderBottomColor='transparent'});
  event?.target?.classList?.add('active',c.t);
  if(event?.target)event.target.style.borderBottomColor=d.color;

  if(curTab==='overview'){
    let antiHtml='';
    if(isModuleOn('antipatterns')){
      antiHtml=`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700 md:col-span-2"><p class="text-xs uppercase tracking-widest text-slate-500 mb-3">Antywzorce â€” zaznacz te, ktÃ³re obserwujesz</p><div class="grid grid-cols-1 md:grid-cols-2 gap-2">${d.anti.map((a,i)=>`<label class="flex gap-2 items-start cursor-pointer"><input type="checkbox" class="mt-1 accent-red-400" onchange="updateAntiDetector('${curArea}')"><span class="text-sm text-slate-400">${a}</span></label>`).join('')}</div><div id="anti-recommendations" class="mt-3"></div></div>`;
    } else {
      antiHtml=`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700 md:col-span-2"><p class="text-xs uppercase tracking-widest text-slate-500 mb-3">Antywzorce</p><div class="grid grid-cols-1 md:grid-cols-2 gap-2">${d.anti.map(a=>`<div class="flex gap-2 items-start"><span class="text-red-400 text-sm mt-0.5">âœ•</span><span class="text-sm text-slate-400">${a}</span></div>`).join('')}</div></div>`;
    }
    let exerciseHtml='';
    if(isModuleOn('exercises')){
      const areaExercises=EXERCISES.filter(e=>e.area===curArea);
      if(areaExercises.length)exerciseHtml=`<div class="md:col-span-2"><p class="text-xs uppercase tracking-widest text-slate-500 mb-3 mt-2">Ä†wiczenia interaktywne</p>${areaExercises.map(e=>renderExercise(e.id)).join('')}</div>`;
    }
    el.innerHTML=`<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-dark-900 rounded-xl p-5 border border-dark-700"><p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Kluczowe pytanie</p><p class="${c.t} font-medium text-base">${d.q}</p></div>
      <div class="bg-dark-900 rounded-xl p-5 border border-dark-700"><p class="text-xs uppercase tracking-widest text-slate-500 mb-2">Poziomy</p>${d.levels.map((l,i)=>`<div class="flex gap-2 items-start mb-3"><span class="w-6 h-6 rounded-full ${c.bg} flex items-center justify-center flex-shrink-0"><span class="${c.t} text-xs font-bold">${i+1}</span></span><div><span class="text-sm font-semibold text-slate-300">${l.l}</span><p class="text-xs text-slate-500">${l.d}</p></div></div>`).join('')}</div>
      ${antiHtml}${exerciseHtml}</div>`;
  }
  if(curTab==='research'){
    const r=RESEARCH.filter(x=>x.area===curArea);
    el.innerHTML=r.map(x=>`<div class="bg-dark-900 rounded-xl p-4 border border-dark-700 mb-3"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] px-2 py-0.5 rounded-full ${c.bg} ${c.t}">${x.type}</span><span class="text-[10px] text-slate-600">${x.year}</span></div><h4 class="text-sm font-semibold text-slate-200">${x.title}</h4><p class="text-[11px] text-slate-500 mb-1">${x.authors}</p><p class="text-xs text-slate-400">${x.finding}</p>${x.src?`<a href="${x.src}" target="_blank" class="text-[11px] ${c.t} hover:underline mt-1 inline-block">Å¹rÃ³dÅ‚o â†’</a>`:''}</div>`).join('');
  }
  if(curTab==='industries'){
    const s=SCENARIOS.filter(x=>x.area.includes(curArea));
    el.innerHTML=s.map(x=>{
      let extra='';
      // Evidence badge
      if(isModuleOn('evidence')&&EVIDENCE_MAP[x.title]){const ev=EVIDENCE_MAP[x.title];extra+=`<span class="text-xs px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400 ml-1" title="${EVIDENCE_TIERS[ev.tier]}">${EVIDENCE_TIERS[ev.tier]}</span>`}
      // Case study
      let csHtml='';
      if(isModuleOn('casestudies')&&CASE_STUDIES[x.title]){const cs=CASE_STUDIES[x.title];csHtml=`<details class="mt-2 bg-dark-950 rounded-lg border border-dark-700"><summary class="p-3 text-sm text-amber-400 cursor-pointer font-medium">ğŸ“– Deep Case Study</summary><div class="p-3 pt-0 space-y-2"><p class="text-sm text-slate-300"><strong class="text-slate-400">Sytuacja:</strong> ${cs.situation}</p><p class="text-sm text-slate-300"><strong class="text-slate-400">Kontekst:</strong> ${cs.context}</p><p class="text-sm text-slate-300"><strong class="text-slate-400">DziaÅ‚anie:</strong> ${cs.action}</p><p class="text-sm text-emerald-400"><strong class="text-slate-400">Rezultat:</strong> ${cs.result}</p>${cs.debrief?`<div class="border-t border-dark-700 pt-2 mt-2"><p class="text-xs text-slate-500 font-bold mb-1">Pytania debriefingowe:</p>${cs.debrief.map(q=>`<p class="text-xs text-slate-400">â†’ ${q}</p>`).join('')}</div>`:''}</div></details>`}
      // Frameworks
      let fwHtml='';
      if(isModuleOn('frameworks')){const fws=Object.entries(FRAMEWORKS).filter(([_,f])=>x.context.some(c=>f.contexts.includes(c)));if(fws.length)fwHtml=`<div class="flex flex-wrap gap-1 mt-2">${fws.map(([k,f])=>`<details class="inline"><summary class="text-xs px-2 py-0.5 rounded-full bg-violet-500/10 text-violet-400 cursor-pointer">ğŸ§© ${f.name}</summary><div class="bg-dark-950 rounded-lg p-2 mt-1 text-xs text-slate-400">${f.steps.map(s=>`<p>â†’ ${s}</p>`).join('')}</div></details>`).join('')}</div>`}
      return`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700 mb-3"><div class="flex items-center flex-wrap gap-1 mb-2"><h4 class="text-sm font-semibold text-slate-200">${x.title}</h4>${extra}</div><p class="text-sm text-slate-400 mb-2">${x.desc}</p><div class="flex flex-wrap gap-1.5 mb-2">${x.industry.map(i=>{const ind=INDUSTRIES.find(z=>z.id===i);return ind?`<span class="text-xs px-2 py-0.5 rounded bg-slate-800 text-slate-400">${ind.icon} ${ind.name}</span>`:''}).join('')}${x.context.map(ctx=>`<span class="text-xs px-2 py-0.5 rounded bg-violet-500/10 text-violet-400">${LIFE_CONTEXTS.find(z=>z.id===ctx)?.icon||''} ${LIFE_CONTEXTS.find(z=>z.id===ctx)?.name||ctx}</span>`).join('')}</div><div class="bg-dark-950 rounded-lg p-3 text-sm text-emerald-400/80"><strong>Tip:</strong> ${x.tip}</div>${csHtml}${fwHtml}</div>`;
    }).join('');
  }
  if(curTab==='tools'){
    const t=TOOLS.filter(x=>x.area===curArea);
    el.innerHTML=`<div class="grid grid-cols-1 md:grid-cols-2 gap-3">${t.map(x=>`<div class="bg-dark-900 rounded-xl p-4 border border-dark-700"><span class="text-[10px] px-2 py-0.5 rounded-full ${c.bg} ${c.t}">${x.type}</span><h4 class="text-sm font-semibold text-slate-200 mt-2 mb-1">${x.name}</h4><p class="text-xs text-slate-400 mb-2">${x.desc}</p><p class="text-[11px] text-slate-500 border-t border-dark-700 pt-2"><span class="text-slate-400">Kiedy:</span> ${x.use}</p></div>`).join('')}</div>`;
  }
}

// ===== EXPLORE (FILTERS + SCENARIOS) =====
function initFilterChips(){
  const mk=(arr,fld,cont)=>{
    let h=`<span class="chip on text-sm px-4 py-1.5 rounded-full bg-slate-800 text-slate-300 border border-slate-700" style="--ring:#94a3b8" data-f="${fld}" data-v="all" onclick="toggleFilter(this)">Wszystkie</span>`;
    arr.forEach(x=>{h+=`<span class="chip text-sm px-4 py-1.5 rounded-full bg-slate-800/50 text-slate-400 border border-slate-700/50" style="--ring:#94a3b8" data-f="${fld}" data-v="${x.id}" onclick="toggleFilter(this)">${x.icon||''} ${x.name}</span>`});
    document.getElementById(cont).innerHTML=h;
  };
  mk(INDUSTRIES,'industry','industry-chips');
  mk(ROLES,'role','role-chips');
  mk(SITUATIONS,'situation','situation-chips');
  mk(LIFE_CONTEXTS,'context','context-chips');
  mk(CHALLENGE_TYPES,'challenge','challenge-chips');
}
function toggleFilter(el){
  const f=el.dataset.f,v=el.dataset.v;
  // deselect all in same group
  el.parentElement.querySelectorAll('.chip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
  filters[f]=v;
  renderExplore();
}
function resetFilters(){
  filters={area:'all',industry:'all',role:'all',situation:'all',context:'all',challenge:'all'};
  document.querySelectorAll('#filter-bar .chip').forEach(c=>{c.classList.remove('on');if(c.dataset.v==='all')c.classList.add('on')});
  renderExplore();
}
function renderExplore(){
  let results=SCENARIOS.filter(s=>{
    if(filters.area!=='all'&&!s.area.includes(filters.area))return false;
    if(filters.industry!=='all'&&!s.industry.includes(filters.industry)&&s.industry.length>0)return false;
    if(filters.industry!=='all'&&s.industry.length===0)return false;
    if(filters.role!=='all'&&!s.role.includes(filters.role)&&s.role.length>0)return false;
    if(filters.role!=='all'&&s.role.length===0)return false;
    if(filters.situation!=='all'&&!s.situation.includes(filters.situation))return false;
    if(filters.context!=='all'&&!s.context.includes(filters.context))return false;
    if(filters.challenge!=='all'&&!s.challenge.includes(filters.challenge))return false;
    return true;
  });
  document.getElementById('result-count').textContent=`${results.length} scenariuszy`;
  document.getElementById('explore-results').innerHTML=results.length?results.map(s=>{
    const areaColors=s.area.map(a=>C[a]||'#94a3b8');
    const mainArea=s.area[0];const c=CC[mainArea]||CC.fast;
    const bookmarked=isModuleOn('progress')&&getProgress().bookmarks.includes(s.title);
    let evidBadge='';if(isModuleOn('evidence')&&EVIDENCE_MAP[s.title]){const ev=EVIDENCE_MAP[s.title];evidBadge=`<span class="text-xs px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400">${EVIDENCE_TIERS[ev.tier]}</span>`}
    return`<div class="scenario-card bg-dark-900 rounded-xl p-5 border border-dark-700 hover:${c.b}">
      <div class="flex items-center justify-between mb-2"><div class="flex items-center gap-1.5">${s.area.map(a=>fluxBadge(a)).join('')}${evidBadge}</div>${isModuleOn('progress')?`<button onclick="event.stopPropagation();toggleBookmark('${s.title.replace(/'/g,"\\'")}');renderExplore()" class="text-lg ${bookmarked?'text-amber-400':'text-slate-600 hover:text-amber-400'}" title="Bookmark">${bookmarked?'â˜…':'â˜†'}</button>`:''}</div>
      <h4 class="text-sm font-semibold text-slate-200 mb-1">${s.title}</h4>
      <p class="text-sm text-slate-400 mb-3">${s.desc}</p>
      <div class="flex flex-wrap gap-1.5 mb-3">${s.industry.map(i=>{const ind=INDUSTRIES.find(z=>z.id===i);return ind?`<span class="text-xs px-2 py-0.5 rounded bg-slate-800 text-slate-400">${ind.icon} ${ind.name}</span>`:''}).join('')}${s.role.map(r=>{const rl=ROLES.find(z=>z.id===r);return rl?`<span class="text-xs px-2 py-0.5 rounded bg-slate-800 text-slate-400">${rl.name}</span>`:''}).join('')}${s.context.map(x=>{const lc=LIFE_CONTEXTS.find(z=>z.id===x);return lc?`<span class="text-xs px-2 py-0.5 rounded bg-violet-500/10 text-violet-400">${lc.icon} ${lc.name}</span>`:''}).join('')}${s.situation.map(x=>{const st=SITUATIONS.find(z=>z.id===x);return st?`<span class="text-xs px-2 py-0.5 rounded bg-cyan-500/10 text-cyan-400">${st.icon} ${st.name}</span>`:''}).join('')}</div>
      <div class="bg-dark-950 rounded-lg p-3 text-sm text-emerald-400/80"><strong>Tip:</strong> ${s.tip}</div>
      ${s.fluxWhy?`<details class="mt-2"><summary class="text-xs text-slate-500 cursor-pointer hover:text-slate-300 transition-colors">Dlaczego ${s.area.map(a=>FLUX[a].letter).join('+')}?</summary><p class="text-xs text-slate-400 mt-1 pl-2 border-l-2 border-dark-700">${s.fluxWhy}</p></details>`:''}
    </div>`;
  }).join(''):`<div class="col-span-2 text-center py-12 text-slate-500 text-sm">Brak scenariuszy dla wybranych filtrÃ³w. <button onclick="resetFilters()" class="text-amber-400 hover:underline">Resetuj</button></div>`;
}

// ===== TREND MAP (Hatalska 2025) =====
function renderTrends(){
  const svg=document.getElementById('trend-map');const cx=500,cy=500;
  const rings={now:180,new:280,next:370,beyond:450};
  // Assign angles dynamically by megaworld sector
  const mwSectors={spoleczny:[-90,-30],ai:[-30,30],lustrzany:[30,90],zrownowazony:[90,150],zdrowie:[150,210],wojny:[210,270]};
  let h=`<circle cx="${cx}" cy="${cy}" r="460" fill="#0c0f1a" stroke="#1e293b" stroke-width=".5"/>`;
  Object.entries(rings).forEach(([k,r])=>{h+=`<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,${k==='now'?.12:k==='new'?.08:k==='next'?.05:.03})" stroke-width="1" ${k!=='now'?'stroke-dasharray="4 2"':''}/>`;});
  h+=`<text x="${cx+5}" y="${cy-rings.now-5}" fill="#475569" font-size="10" letter-spacing="2">NOW</text>`;
  h+=`<text x="${cx+5}" y="${cy-rings.new-5}" fill="#334155" font-size="10" letter-spacing="2">NEW 1-5 lat</text>`;
  h+=`<text x="${cx+5}" y="${cy-rings.next-5}" fill="#1e293b" font-size="10" letter-spacing="2">NEXT 5-15 lat</text>`;
  h+=`<text x="${cx+5}" y="${cy-rings.beyond-5}" fill="#1e293b" font-size="10" letter-spacing="2">BEYOND 15+</text>`;
  // Sector dividers (6 sectors for megaworlds)
  Object.values(mwSectors).forEach(([start])=>{
    const a=start*Math.PI/180;
    h+=`<line x1="${cx+60*Math.cos(a)}" y1="${cy+60*Math.sin(a)}" x2="${cx+460*Math.cos(a)}" y2="${cy+460*Math.sin(a)}" stroke="#1e293b" stroke-width=".5"/>`;
  });
  // Sector fills + labels
  Object.entries(mwSectors).forEach(([mwId,[start,end]])=>{
    const mw=MEGAWORLDS[mwId];
    const a1=start*Math.PI/180,a2=end*Math.PI/180;
    const mid=(start+end)/2*Math.PI/180;
    h+=`<path d="M${cx},${cy} L${cx+460*Math.cos(a1)},${cy+460*Math.sin(a1)} A460,460 0 0,1 ${cx+460*Math.cos(a2)},${cy+460*Math.sin(a2)} Z" fill="${mw.color}" opacity=".04"/>`;
    const lx=cx+395*Math.cos(mid),ly=cy+395*Math.sin(mid);
    h+=`<text x="${lx}" y="${ly}" text-anchor="middle" fill="${mw.color}" font-size="7" font-weight="600" opacity=".6">${mw.icon} ${mw.name}</text>`;
  });
  // Plot trends
  const trendsByMw={};
  TRENDS.forEach(t=>{if(!trendsByMw[t.mw])trendsByMw[t.mw]={};if(!trendsByMw[t.mw][t.ring])trendsByMw[t.mw][t.ring]=[];trendsByMw[t.mw][t.ring].push(t)});
  TRENDS.forEach(t=>{
    const sector=mwSectors[t.mw];if(!sector)return;
    const ringTrends=trendsByMw[t.mw]?.[t.ring]||[];
    const idx=ringTrends.indexOf(t);
    const spread=sector[1]-sector[0]-4;
    const step=ringTrends.length>1?spread/(ringTrends.length-1):0;
    const angle=sector[0]+2+(step*idx);
    const r=rings[t.ring],a=angle*Math.PI/180,x=cx+r*Math.cos(a),y=cy+r*Math.sin(a);
    const sz=t.ring==='now'?5:t.ring==='new'?4:t.ring==='next'?3.5:3;
    const op=t.ring==='now'?.9:t.ring==='new'?.65:t.ring==='next'?.4:.25;
    const mw=MEGAWORLDS[t.mw];
    // Filtering
    const showMw=mwFilter==='all'||mwFilter===t.mw;
    const showFlux=trendFilter==='all'||t.flux.includes(trendFilter);
    const showHr=!hrOnly||t.hr;
    const show=showMw&&showFlux&&showHr;
    const dotColor=mw.color;
    h+=`<g class="cursor-pointer" onclick="showTrendPopup(event,'${t.name.replace(/'/g,"\\'")}')" style="opacity:${show?1:.06};transition:opacity .4s">
      <circle cx="${x}" cy="${y}" r="${sz}" fill="${dotColor}" opacity="${op}"/>
      ${t.hr?`<circle cx="${x}" cy="${y}" r="${sz+2}" fill="none" stroke="#eab308" stroke-width="1" opacity="${op*.7}"/>`:''}
      <text x="${x}" y="${y-sz-4}" text-anchor="middle" fill="${dotColor}" font-size="7" opacity="${op*.85}" font-weight="500">${t.name}</text>
    </g>`;
  });
  h+=`<circle cx="${cx}" cy="${cy}" r="55" fill="#111827" stroke="#334155"/><text x="${cx}" y="${cy-3}" text-anchor="middle" fill="white" font-size="20" font-weight="900" letter-spacing="4">FLUX</text><text x="${cx}" y="${cy+12}" text-anchor="middle" fill="#64748b" font-size="7" letter-spacing="2">MAPA TRENDÃ“W 2025</text>`;
  svg.innerHTML=h;
  // Render filters below
  renderTrendFilters();
}
function renderTrendFilters(){
  const el=document.getElementById('trend-filters');if(!el)return;
  el.innerHTML=`
    <div class="flex flex-wrap gap-2 items-center justify-center mb-2">
      <span class="text-[10px] text-slate-500">FLUX:</span>
      <button onclick="trendFilter='all';renderTrends()" class="tf text-[10px] px-2 py-1 rounded-full border ${trendFilter==='all'?'border-amber-500 text-amber-400':'border-dark-700 text-slate-500'}">Wszystkie</button>
      ${['fast','liquid','unlearn','experiment'].map(a=>`<button onclick="trendFilter='${a}';renderTrends()" class="tf text-[10px] px-2 py-1 rounded-full border ${trendFilter===a?'border-amber-500 '+CC[a].t:'border-dark-700 text-slate-500'}">${FLUX[a].letter}</button>`).join('')}
    </div>
    <div class="flex flex-wrap gap-2 items-center justify-center mb-2">
      <span class="text-[10px] text-slate-500">MegaÅ›wiat:</span>
      <button onclick="mwFilter='all';renderTrends()" class="mf text-[10px] px-2 py-1 rounded-full border ${mwFilter==='all'?'border-amber-500 text-amber-400':'border-dark-700 text-slate-500'}">Wszystkie</button>
      ${Object.entries(MEGAWORLDS).map(([id,mw])=>`<button onclick="mwFilter='${id}';renderTrends()" class="mf text-[10px] px-2 py-1 rounded-full border" style="border-color:${mwFilter===id?mw.color:'#334155'};color:${mwFilter===id?mw.color:'#64748b'}">${mw.icon} ${mw.name}</button>`).join('')}
    </div>
    <div class="flex items-center justify-center gap-3 mb-2">
      <label class="flex items-center gap-1 cursor-pointer text-[10px] ${hrOnly?'text-amber-400':'text-slate-500'}">
        <input type="checkbox" ${hrOnly?'checked':''} onchange="hrOnly=this.checked;renderTrends()" class="w-3 h-3 accent-amber-500"> Tylko trendy HR
      </label>
    </div>
    <div class="flex flex-wrap gap-2 items-center justify-center">
      ${Object.entries(MEGAWORLDS).map(([id,mw])=>`<span class="text-[10px] flex items-center gap-1"><span class="w-2 h-2 rounded-full inline-block" style="background:${mw.color}"></span>${mw.name}</span>`).join('')}
      <span class="text-[10px] flex items-center gap-1 ml-2"><span class="w-3 h-3 rounded-full border border-amber-500 inline-block"></span>Trend HR</span>
    </div>`;
}
function showTrendPopup(ev,name){
  ev.stopPropagation();
  document.getElementById('trend-popup')?.remove();
  const t=TRENDS.find(tr=>tr.name===name);if(!t)return;
  const mw=MEGAWORLDS[t.mw];
  const div=document.createElement('div');
  div.id='trend-popup';
  div.className='fixed z-[10002] max-w-sm p-4 bg-dark-900/95 backdrop-blur-md border border-dark-700 rounded-xl shadow-2xl';
  div.innerHTML=`
    <div class="flex items-center gap-2 mb-2">
      <span class="mw-badge" style="background:${mw.color}20;color:${mw.color}">${mw.icon} ${mw.name}</span>
      <span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-800 text-slate-400">${t.ring.toUpperCase()}</span>
      ${t.hr?'<span class="text-[10px] px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400">âš¡ Trend HR</span>':''}
    </div>
    <h4 class="text-sm font-bold text-slate-200 mb-1">${t.name}</h4>
    <p class="text-xs text-slate-400 mb-3">${t.desc}</p>
    <p class="text-[10px] text-slate-500 uppercase mb-1">WpÅ‚yw na FLUX</p>
    <div class="flex gap-1 mb-2">${t.flux.map(a=>fluxBadge(a,{clickAction:'detail'})).join('')}</div>
    <button class="text-xs text-slate-500 hover:text-white" onclick="document.getElementById('trend-popup')?.remove()">Zamknij âœ•</button>`;
  div.style.left=Math.min(ev.clientX,window.innerWidth-350)+'px';
  div.style.top=Math.min(ev.clientY-10,window.innerHeight-250)+'px';
  document.body.appendChild(div);
  setTimeout(()=>{document.addEventListener('click',function h(e){if(!div.contains(e.target)){div.remove();document.removeEventListener('click',h)}})},10);
}
function filterTrends(f){trendFilter=f;renderTrends();}

// ===== RESEARCH VIEW =====
function renderResearch(){
  const list=resFilter==='all'?RESEARCH:RESEARCH.filter(r=>r.area===resFilter);
  document.getElementById('research-grid').innerHTML=list.map(r=>{const c=CC[r.area];return`<div class="bg-dark-900 rounded-xl p-4 border border-dark-700 cursor-pointer" onclick="this.classList.toggle('expanded')"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] px-2 py-0.5 rounded-full ${c.bg} ${c.t}">${FLUX[r.area].name}</span><span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-800 text-slate-400">${r.type}</span><span class="text-[10px] text-slate-600 ml-auto">${r.year}</span></div><h4 class="text-sm font-semibold text-slate-200">${r.title}</h4><p class="text-[11px] text-slate-500">${r.authors}</p><div class="expand-content" style="max-height:0;overflow:hidden;transition:max-height .4s"><div class="mt-2 pt-2 border-t border-dark-700"><p class="text-xs text-slate-400">${r.finding}</p>${r.src?`<a href="${r.src}" target="_blank" class="text-[11px] ${c.t} hover:underline mt-1 inline-block">Å¹rÃ³dÅ‚o â†’</a>`:''}</div></div><p class="text-[10px] text-slate-600 mt-1">Kliknij â†“</p></div>`;}).join('');
  // fix expand
  document.querySelectorAll('#research-grid .expand-content').forEach(el=>{
    el.closest('[onclick]').addEventListener('click',function(){
      const exp=this.querySelector('.expand-content');
      exp.style.maxHeight=exp.style.maxHeight==='0px'||!exp.style.maxHeight?exp.scrollHeight+'px':'0px';
    },{once:false});
  });
}
function filterRes(f){resFilter=f;document.querySelectorAll('.rf').forEach(b=>b.classList.remove('on'));event.target.classList.add('on');renderResearch();}

// ===== TOOLS VIEW =====
function renderTools(){
  const areas=['fast','liquid','unlearn','experiment'];
  document.getElementById('tools-grid').innerHTML=areas.map(a=>{const d=FLUX[a],c=CC[a],t=TOOLS.filter(x=>x.area===a);
    return`<div class="mb-6"><div class="flex items-center gap-2 mb-3"><div class="w-8 h-8 rounded-lg ${c.bg} flex items-center justify-center"><span class="${c.t} font-black">${d.letter}</span></div><span class="${c.t} font-bold">${d.name}</span><span class="text-xs text-slate-600">${t.length} narzÄ™dzi</span></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">${t.map(x=>{const idx=TOOLS.indexOf(x);return`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700"><span class="text-xs px-2 py-0.5 rounded-full ${c.bg} ${c.t}">${x.type}</span><h4 class="text-sm font-semibold text-slate-200 mt-2 mb-1">${x.name}</h4><p class="text-sm text-slate-400 mb-2">${x.desc}</p><p class="text-xs text-slate-500 border-t border-dark-700 pt-2"><span class="text-slate-400">Kiedy:</span> ${x.use}</p>${isModuleOn('canvases')?`<button onclick="downloadCanvas(${idx})" class="mt-2 text-xs text-amber-400 hover:underline">ğŸ“¥ Pobierz Canvas</button>`:''}</div>`}).join('')}</div></div>`;
  }).join('');
}

// ===== GEMINI CHAT =====
const FLUX_SYSTEM_PROMPT=`JesteÅ› ekspertem modelu FLUX â€” ramy kompetencyjno-operacyjnej.
FLUX = Fast (tempo decyzji), Liquid (wspÃ³Å‚praca i PS), Unlearn & Relearn (oduczanie siÄ™), eXperiment (innowacje).
Odpowiadaj po polsku, konkretnie, evidence-based. Podawaj przykÅ‚ady z branÅ¼ (automotive, e-commerce, farmacja, ubezpieczenia, OZE, FMCG, start-upy, IT, bankowoÅ›Ä‡, retail).
Model dziaÅ‚a zarÃ³wno w kontekÅ›cie zawodowym (trener, lider, manager, specjalista) jak i prywatnym (mÄ…Å¼, ojciec, zdrowie, hobby, finanse).
Kluczowe badania: Eisenhardt 1989 (fast decisions), Edmondson 1999 (PS), Frazier 2017 (PS meta-analysis), van Dyck 2005 (error management), Brynjolfsson 2023 (GenAI at work).
NarzÄ™dzia: Decision 15min, PS Radar, Skill Gap Analyzer, Hypothesis Builder, Learning Loop, Collaboration Flow Map.
BÄ…dÅº konkretny, podawaj actionable tips. Nie lej wody.`;

let chatHistory=[];
function toggleChat(){document.getElementById('chat-panel').classList.toggle('open')}
async function sendChat(){
  const input=document.getElementById('chat-input');
  const text=input.value.trim();if(!text)return;
  input.value='';addChatMsg(text,'user');
  const status=document.getElementById('chat-status');
  const btn=document.getElementById('chat-send');
  btn.disabled=true;status.textContent='Analizuje...';

  const apiKey=localStorage.getItem('flux_gemini_key');
  if(!apiKey){addChatMsg('Brak klucza Gemini API. Kliknij ikonÄ™ ustawieÅ„ (âš™ï¸) w nawigacji i wpisz klucz z aistudio.google.com (darmowy).','assistant');btn.disabled=false;status.textContent='';return;}

  chatHistory.push({role:'user',parts:[{text}]});
  try{
    const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({system_instruction:{parts:[{text:FLUX_SYSTEM_PROMPT}]},contents:chatHistory,generationConfig:{temperature:0.4,maxOutputTokens:1500}})
    });
    if(!r.ok){const e=await r.text();throw new Error(r.status===429?'Limit API (15/min). Poczekaj.':r.status===403?'Klucz API bez uprawnieÅ„.':'BÅ‚Ä…d '+r.status)}
    const d=await r.json();
    const reply=d.candidates?.[0]?.content?.parts?.[0]?.text||'Brak odpowiedzi.';
    chatHistory.push({role:'model',parts:[{text:reply}]});
    addChatMsg(reply,'assistant');
  }catch(e){addChatMsg('BÅ‚Ä…d: '+e.message,'assistant')}
  btn.disabled=false;status.textContent='';
}
function addChatMsg(text,role){
  const div=document.createElement('div');div.className=`chat-msg ${role}`;
  div.innerHTML=role==='assistant'?text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>'):text;
  document.getElementById('chat-messages').appendChild(div);
  document.getElementById('chat-messages').scrollTop=9999;
}

// ===== SETTINGS =====
function openSettings(){document.getElementById('settings-overlay').classList.add('open');const k=localStorage.getItem('flux_gemini_key');if(k)document.getElementById('api-key-input').value=k}
function closeSettings(){document.getElementById('settings-overlay').classList.remove('open')}
function saveApiKey(){const k=document.getElementById('api-key-input').value.trim();if(!k)return;localStorage.setItem('flux_gemini_key',k);document.getElementById('settings-status').innerHTML='<span class="text-emerald-400">Zapisano!</span>';setTimeout(closeSettings,1000)}
function clearApiKey(){localStorage.removeItem('flux_gemini_key');document.getElementById('api-key-input').value='';document.getElementById('settings-status').innerHTML='<span class="text-slate-400">Wyczyszczono.</span>'}

// ===== MODULE: DIAGNOSTIC + RADAR (#1, #15) =====
const DIAGNOSTIC_QUESTIONS=[
  {area:'fast',q:'Jak szybko TwÃ³j zespÃ³Å‚ przechodzi od identyfikacji problemu do dziaÅ‚ania?'},
  {area:'fast',q:'Czy masz jasne kryteria "good enough" do podjÄ™cia decyzji?'},
  {area:'fast',q:'Jak czÄ™sto decyzje sÄ… blokowane przez oczekiwanie na peÅ‚ne dane?'},
  {area:'fast',q:'Czy TwÃ³j zespÃ³Å‚ ma uprawnienia do podejmowania decyzji bez eskalacji?'},
  {area:'liquid',q:'Czy ludzie otwarcie mÃ³wiÄ… o bÅ‚Ä™dach bez obawy o konsekwencje?'},
  {area:'liquid',q:'Jak sprawnie informacja przepÅ‚ywa miÄ™dzy zespoÅ‚ami/dziaÅ‚ami?'},
  {area:'liquid',q:'Czy feedback jest regularny, dwustronny i konstruktywny?'},
  {area:'liquid',q:'Czy spotkania koÅ„czÄ… siÄ™ konkretnymi action items z wÅ‚aÅ›cicielami?'},
  {area:'unlearn',q:'Kiedy ostatnio TwÃ³j zespÃ³Å‚ Å›wiadomie porzuciÅ‚ stary proces?'},
  {area:'unlearn',q:'Jak otwarte sÄ… postawy wobec AI i nowych technologii?'},
  {area:'unlearn',q:'Czy regularnie przeglÄ…dacie i aktualizujecie kompetencje?'},
  {area:'unlearn',q:'Czy organizacja traktuje uczenie siÄ™ jako proces ciÄ…gÅ‚y?'},
  {area:'experiment',q:'Ile eksperymentÃ³w przeprowadziliÅ›cie w ostatnim kwartale?'},
  {area:'experiment',q:'Czy bÅ‚Ä…d eksperymentu jest traktowany jako ÅºrÃ³dÅ‚o danych, nie poraÅ¼ka?'},
  {area:'experiment',q:'Czy macie budÅ¼et i czas na testowanie nowych pomysÅ‚Ã³w?'},
  {area:'experiment',q:'Czy dokumentujecie wyniki eksperymentÃ³w systematycznie?'}
];
let diagnosticAnswers={};

function renderDiagnosticView(){
  const el=document.getElementById('diagnostic-content');if(!el)return;
  const saved=localStorage.getItem('flux_diagnostic');
  if(saved&&!window._diagRetake){
    const d=JSON.parse(saved);
    renderDiagnosticResults(d);return;
  }
  const areas=['fast','liquid','unlearn','experiment'];
  el.innerHTML=areas.map(a=>{
    const qs=DIAGNOSTIC_QUESTIONS.filter(q=>q.area===a);const d=FLUX[a],c=CC[a];
    return`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700 mb-4">
      <div class="flex items-center gap-2 mb-3"><div class="w-8 h-8 rounded-lg ${c.bg} flex items-center justify-center"><span class="${c.t} font-black">${d.letter}</span></div><span class="${c.t} font-bold">${d.name}</span></div>
      ${qs.map((q,i)=>{const idx=DIAGNOSTIC_QUESTIONS.indexOf(q);return`<div class="mb-4"><p class="text-sm text-slate-300 mb-2">${i+1}. ${q.q}</p><div class="flex gap-2">${[1,2,3,4,5].map(v=>`<button class="scale-btn ${diagnosticAnswers[idx]===v?'selected':''}" onclick="setDiagAnswer(${idx},${v})">${v}</button>`).join('')}</div></div>`}).join('')}
    </div>`;
  }).join('')+`<div class="text-center"><button onclick="submitDiagnostic()" class="bg-amber-500 hover:bg-amber-400 text-dark-950 font-bold px-8 py-3 rounded-xl text-sm transition-colors">SprawdÅº wyniki</button></div>`;
}

function setDiagAnswer(idx,val){diagnosticAnswers[idx]=val;renderDiagnosticView()}

function submitDiagnostic(){
  if(Object.keys(diagnosticAnswers).length<16){alert('Odpowiedz na wszystkie 16 pytaÅ„.');return}
  const scores={};
  ['fast','liquid','unlearn','experiment'].forEach(a=>{
    const qs=DIAGNOSTIC_QUESTIONS.map((q,i)=>({...q,i})).filter(q=>q.area===a);
    scores[a]=+(qs.reduce((s,q)=>s+diagnosticAnswers[q.i],0)/qs.length).toFixed(1);
  });
  const result={timestamp:Date.now(),scores};
  localStorage.setItem('flux_diagnostic',JSON.stringify(result));
  // Save to history
  const hist=JSON.parse(localStorage.getItem('flux_diagnostic_history')||'[]');
  hist.push(result);localStorage.setItem('flux_diagnostic_history',JSON.stringify(hist));
  window._diagRetake=false;diagnosticAnswers={};
  renderDiagnosticResults(result);
}

function renderDiagnosticResults(result){
  const el=document.getElementById('diagnostic-content');const s=result.scores;
  const avg=+((s.fast+s.liquid+s.unlearn+s.experiment)/4).toFixed(1);
  const level=avg>=4?'Zaawansowany':avg>=2.5?'Praktyk':'PoczÄ…tkujÄ…cy';
  const levelColor=avg>=4?'text-emerald-400':avg>=2.5?'text-amber-400':'text-red-400';
  el.innerHTML=`
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="bg-dark-900 rounded-xl p-5 border border-dark-700 text-center">
        <p class="text-xs text-slate-500 mb-1">TwÃ³j poziom FLUX</p>
        <p class="text-2xl font-black ${levelColor}">${level}</p>
        <p class="text-sm text-slate-400 mt-1">Åšrednia: ${avg}/5</p>
      </div>
      <div class="bg-dark-900 rounded-xl p-5 border border-dark-700">
        <div class="grid grid-cols-2 gap-3">
          ${['fast','liquid','unlearn','experiment'].map(a=>`<div class="text-center"><span class="${CC[a].t} font-black text-lg">${s[a]}</span><p class="text-xs text-slate-500">${FLUX[a].name}</p></div>`).join('')}
        </div>
      </div>
    </div>
    ${isModuleOn('radar')?`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700 mb-6"><p class="text-xs text-slate-500 mb-3 text-center">Profil FLUX â€” Radar Chart</p><div class="flex justify-center"><svg viewBox="0 0 400 400" class="radar-svg" style="max-width:350px;width:100%">${renderRadarChart(s)}</svg></div></div>`:''}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">${['fast','liquid','unlearn','experiment'].map(a=>{
      const v=s[a],bar=v/5*100,c=CC[a];
      return`<div class="bg-dark-900 rounded-xl p-4 border border-dark-700"><div class="flex justify-between items-center mb-2"><span class="${c.t} font-bold text-sm">${FLUX[a].name}</span><span class="${c.t} font-bold">${v}/5</span></div><div class="w-full h-2 bg-dark-700 rounded-full"><div class="h-full rounded-full" style="width:${bar}%;background:${C[a]}"></div></div><p class="text-xs text-slate-500 mt-1">${v>=4?'Mocna strona â€” utrzymuj!':v>=2.5?'Dobra baza â€” rozwijaj':'Priorytet do rozwoju'}</p></div>`;
    }).join('')}</div>
    <div class="text-center"><button onclick="window._diagRetake=true;diagnosticAnswers={};renderDiagnosticView()" class="text-sm text-amber-400 hover:underline">Wykonaj ponownie</button></div>`;
}

function renderRadarChart(scores){
  const cx=200,cy=200,maxR=150,areas=['fast','liquid','unlearn','experiment'];
  const angles=areas.map((_,i)=>-Math.PI/2+i*(2*Math.PI/4));
  let h='';
  // Grid rings
  [1,2,3,4,5].forEach(l=>{const r=maxR*l/5;
    h+=`<polygon points="${angles.map(a=>`${cx+r*Math.cos(a)},${cy+r*Math.sin(a)}`).join(' ')}" fill="none" stroke="#1e293b" stroke-width="1"/>`;
    if(l%2===1)h+=`<text x="${cx+4}" y="${cy-r+4}" fill="#334155" font-size="9">${l}</text>`;
  });
  // Axis lines + labels
  areas.forEach((a,i)=>{const ang=angles[i];
    h+=`<line x1="${cx}" y1="${cy}" x2="${cx+maxR*Math.cos(ang)}" y2="${cy+maxR*Math.sin(ang)}" stroke="#1e293b" stroke-width="1"/>`;
    const lx=cx+(maxR+25)*Math.cos(ang),ly=cy+(maxR+25)*Math.sin(ang);
    h+=`<text x="${lx}" y="${ly}" text-anchor="middle" fill="${C[a]}" font-size="12" font-weight="700">${FLUX[a].letter}</text>`;
  });
  // Score polygon
  const pts=areas.map((a,i)=>{const r=maxR*scores[a]/5;return`${cx+r*Math.cos(angles[i])},${cy+r*Math.sin(angles[i])}`}).join(' ');
  h+=`<polygon points="${pts}" fill="rgba(245,158,11,.15)" stroke="#f59e0b" stroke-width="2"/>`;
  // Score dots
  areas.forEach((a,i)=>{const r=maxR*scores[a]/5;
    h+=`<circle cx="${cx+r*Math.cos(angles[i])}" cy="${cy+r*Math.sin(angles[i])}" r="5" fill="${C[a]}" stroke="#0c0f1a" stroke-width="2"/>`;
  });
  return h;
}

// ===== MODULE: ONBOARDING (#11) =====
let onboardingStep=0;
const ONBOARDING_ROLES=['Manager','Team Lead','Specjalista','Handlowiec','HR','Trener','Founder','Agent'];
const ONBOARDING_INDUSTRIES=['Automotive','E-commerce','Farmacja','Ubezpieczenia','OZE','FMCG','Start-up','IT','BankowoÅ›Ä‡','Retail'];
const ONBOARDING_CHALLENGES=['SzybkoÅ›Ä‡ decyzji','WspÃ³Å‚praca w zespole','Adaptacja do zmian','InnowacyjnoÅ›Ä‡','Komunikacja','Budowanie zaufania'];

function showOnboarding(){onboardingStep=0;document.getElementById('onboarding-overlay').classList.add('open');renderOnboardingStep()}
function closeOnboarding(){document.getElementById('onboarding-overlay').classList.remove('open')}

function renderOnboardingStep(){
  const el=document.getElementById('onboarding-content');
  const steps=[
    {title:'Kim jesteÅ›?',desc:'Wybierz swojÄ… rolÄ™:',items:ONBOARDING_ROLES,key:'role'},
    {title:'Twoja branÅ¼a?',desc:'Wybierz branÅ¼Ä™:',items:ONBOARDING_INDUSTRIES,key:'industry'},
    {title:'Twoje wyzwanie?',desc:'Co jest najwaÅ¼niejsze?',items:ONBOARDING_CHALLENGES,key:'challenge'}
  ];
  const s=steps[onboardingStep];
  el.innerHTML=`
    <div class="flex justify-center gap-2 mb-4">${steps.map((_,i)=>`<div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${i===onboardingStep?'bg-amber-500 text-dark-950':i<onboardingStep?'bg-emerald-500/20 text-emerald-400':'bg-dark-700 text-slate-500'}">${i+1}</div>`).join('')}</div>
    <h3 class="text-lg font-bold text-slate-200 text-center mb-1">${s.title}</h3>
    <p class="text-sm text-slate-400 text-center mb-4">${s.desc}</p>
    <div class="grid grid-cols-2 gap-2">${s.items.map(item=>`<button onclick="selectOnboarding('${s.key}','${item}')" class="bg-dark-950 border border-dark-700 rounded-lg py-3 px-4 text-sm text-slate-300 hover:border-amber-500 hover:text-amber-400 transition-all">${item}</button>`).join('')}</div>
    ${onboardingStep>0?'<button onclick="onboardingStep--;renderOnboardingStep()" class="text-xs text-slate-500 hover:text-white mt-3 block mx-auto">â† Wstecz</button>':''}`;
}

function selectOnboarding(key,val){
  const profile=JSON.parse(localStorage.getItem('flux_profile')||'{}');
  profile[key]=val;localStorage.setItem('flux_profile',JSON.stringify(profile));
  if(onboardingStep<2){onboardingStep++;renderOnboardingStep()}
  else finishOnboarding(profile);
}

function finishOnboarding(profile){
  closeOnboarding();
  const challengeMap={'SzybkoÅ›Ä‡ decyzji':'fast','WspÃ³Å‚praca w zespole':'liquid','Adaptacja do zmian':'unlearn','InnowacyjnoÅ›Ä‡':'experiment','Komunikacja':'liquid','Budowanie zaufania':'liquid'};
  const area=challengeMap[profile.challenge]||'fast';
  if(isModuleOn('diagnostic'))nav('diagnostic');else showDetail(area);
}

// ===== MODULE: PROGRESS (#13) =====
function getProgress(){try{return JSON.parse(localStorage.getItem('flux_progress')||'{"viewed":[],"bookmarks":[],"reflections":[],"exercises":0}')}catch(e){return{viewed:[],bookmarks:[],reflections:[],exercises:0}}}
function saveProgress(p){localStorage.setItem('flux_progress',JSON.stringify(p))}

function trackViewVisit(v){
  if(!isModuleOn('progress'))return;
  const p=getProgress();if(!p.viewed.includes(v)){p.viewed.push(v);saveProgress(p)}updateProgressBar();
}

function updateProgressBar(){
  if(!isModuleOn('progress'))return;
  const p=getProgress();
  const totalViews=5+MODULES.filter(m=>m.nav&&isModuleOn(m.id)).length;
  const pct=Math.min(100,Math.round(p.viewed.length/totalViews*40+p.reflections.length*10+p.exercises*5+p.bookmarks.length*3));
  document.getElementById('progress-fill').style.width=pct+'%';
}

function toggleBookmark(title){
  if(!isModuleOn('progress'))return;
  const p=getProgress();const i=p.bookmarks.indexOf(title);
  if(i===-1)p.bookmarks.push(title);else p.bookmarks.splice(i,1);
  saveProgress(p);updateProgressBar();
}

// ===== MODULE: REFLECTION (#12) =====
function openReflection(){document.getElementById('reflection-overlay').classList.add('open')}
function closeReflection(){document.getElementById('reflection-overlay').classList.remove('open')}
function saveReflection(){
  const r3=document.getElementById('refl-3').value,r2=document.getElementById('refl-2').value,r1=document.getElementById('refl-1').value;
  if(!r3&&!r2&&!r1){return}
  const p=getProgress();p.reflections.push({ts:Date.now(),three:r3,two:r2,one:r1});saveProgress(p);
  document.getElementById('refl-status').innerHTML='<span class="text-emerald-400">Zapisano refleksjÄ™!</span>';
  updateProgressBar();setTimeout(closeReflection,1500);
}
function saveAndAskAI(){
  saveReflection();
  const r3=document.getElementById('refl-3').value,r2=document.getElementById('refl-2').value;
  if(r2){document.getElementById('chat-input').value=r2;toggleChat();setTimeout(sendChat,500)}
}

// ===== MODULE: ACTION PLAN (#2) =====
function getActions(){try{return JSON.parse(localStorage.getItem('flux_actions')||'[]')}catch(e){return[]}}
function saveActions(a){localStorage.setItem('flux_actions',JSON.stringify(a))}

function renderActionPlanView(){
  const el=document.getElementById('actionplan-content');if(!el)return;
  const actions=getActions();
  el.innerHTML=`
    <div class="bg-dark-900 rounded-xl p-5 border border-dark-700 mb-4">
      <h3 class="text-sm font-bold text-slate-300 mb-3">Dodaj nowe dziaÅ‚anie</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
        <input id="ap-action" placeholder="DziaÅ‚anie..." class="bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-amber-500">
        <input id="ap-deadline" type="date" class="bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-amber-500">
        <input id="ap-metric" placeholder="Metryka sukcesu..." class="bg-dark-950 border border-dark-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-amber-500">
      </div>
      <button onclick="addAction()" class="bg-amber-500 hover:bg-amber-400 text-dark-950 font-bold px-6 py-2 rounded-lg text-sm">Dodaj</button>
    </div>
    ${actions.length?`<div class="bg-dark-900 rounded-xl border border-dark-700 overflow-hidden">
      <table class="w-full text-sm"><thead><tr class="border-b border-dark-700"><th class="text-left p-3 text-slate-500 text-xs">DziaÅ‚anie</th><th class="text-left p-3 text-slate-500 text-xs">Deadline</th><th class="text-left p-3 text-slate-500 text-xs">Metryka</th><th class="p-3 text-slate-500 text-xs">Status</th><th class="p-3"></th></tr></thead>
      <tbody>${actions.map((a,i)=>`<tr class="border-b border-dark-700/50 ${a.done?'opacity-50':''}"><td class="p-3 text-slate-300 ${a.done?'line-through':''}">${a.action}</td><td class="p-3 text-slate-400">${a.deadline||'â€”'}</td><td class="p-3 text-slate-400">${a.metric||'â€”'}</td><td class="p-3 text-center"><button onclick="toggleAction(${i})" class="text-lg">${a.done?'âœ…':'â¬œ'}</button></td><td class="p-3 text-center"><button onclick="removeAction(${i})" class="text-red-400 hover:text-red-300 text-xs">âœ•</button></td></tr>`).join('')}</tbody></table>
    </div>
    <div class="text-center mt-4"><button onclick="exportActions()" class="text-xs text-amber-400 hover:underline">Eksportuj do .txt</button></div>`:`<div class="text-center py-8 text-slate-500 text-sm">Brak dziaÅ‚aÅ„. Dodaj pierwsze powyÅ¼ej.</div>`}`;
}

function addAction(){
  const action=document.getElementById('ap-action').value.trim();if(!action)return;
  const deadline=document.getElementById('ap-deadline').value;
  const metric=document.getElementById('ap-metric').value.trim();
  const actions=getActions();actions.push({action,deadline,metric,done:false});saveActions(actions);renderActionPlanView();
}
function toggleAction(i){const a=getActions();a[i].done=!a[i].done;saveActions(a);renderActionPlanView()}
function removeAction(i){const a=getActions();a.splice(i,1);saveActions(a);renderActionPlanView()}
function exportActions(){
  const a=getActions();const txt=a.map((x,i)=>`${x.done?'[âœ“]':'[ ]'} ${x.action} | ${x.deadline||'brak'} | ${x.metric||'brak'}`).join('\n');
  const blob=new Blob(['FLUX Action Plan\n'+new Date().toLocaleDateString('pl')+'\n\n'+txt],{type:'text/plain'});
  const url=URL.createObjectURL(blob);const a2=document.createElement('a');a2.href=url;a2.download='flux-action-plan.txt';a2.click();URL.revokeObjectURL(url);
}

// ===== MODULE: TRAINER DASHBOARD (#3) =====
function renderTrainerView(){
  const el=document.getElementById('trainer-content');if(!el)return;
  const url=window.location.href;
  const hist=JSON.parse(localStorage.getItem('flux_diagnostic_history')||'[]');
  el.innerHTML=`
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="bg-dark-900 rounded-xl p-5 border border-dark-700 text-center">
        <p class="text-xs text-slate-500 mb-3">QR Code â€” udostÄ™pnij uczestnikom</p>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}&bgcolor=111827&color=f59e0b" alt="QR" class="mx-auto rounded-lg" style="max-width:200px">
        <p class="text-xs text-slate-400 mt-2 break-all">${url}</p>
      </div>
      <div class="bg-dark-900 rounded-xl p-5 border border-dark-700">
        <p class="text-xs text-slate-500 mb-3">Statystyki diagnostyk</p>
        <div class="text-center">
          <span class="text-3xl font-black text-amber-400">${hist.length}</span>
          <p class="text-sm text-slate-400">wypeÅ‚nionych diagnostyk</p>
        </div>
        ${hist.length?`<div class="mt-4 space-y-2">${['fast','liquid','unlearn','experiment'].map(a=>{
          const avg=+(hist.reduce((s,h)=>s+h.scores[a],0)/hist.length).toFixed(1);
          return`<div class="flex items-center gap-2"><span class="${CC[a].t} font-bold text-xs w-8">${FLUX[a].letter}</span><div class="flex-1 h-2 bg-dark-700 rounded-full"><div class="h-full rounded-full" style="width:${avg/5*100}%;background:${C[a]}"></div></div><span class="text-xs text-slate-400 w-8">${avg}</span></div>`;
        }).join('')}</div>`:'<p class="text-xs text-slate-500 mt-4 text-center">Brak danych â€” poproÅ› uczestnikÃ³w o wypeÅ‚nienie diagnostyki.</p>'}
      </div>
    </div>
    <div class="text-center"><button onclick="exportTrainerReport()" class="bg-violet-600 hover:bg-violet-500 text-white font-bold px-6 py-2 rounded-lg text-sm">Eksportuj raport HTML</button></div>`;
}

function exportTrainerReport(){
  const hist=JSON.parse(localStorage.getItem('flux_diagnostic_history')||'[]');
  const areas=['fast','liquid','unlearn','experiment'];
  const avgs=areas.map(a=>+(hist.reduce((s,h)=>s+h.scores[a],0)/Math.max(1,hist.length)).toFixed(1));
  const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>FLUX Trainer Report</title><style>body{font-family:Inter,sans-serif;max-width:800px;margin:auto;padding:2rem;background:#0c0f1a;color:#e2e8f0}h1{color:#f59e0b}.bar{height:1.5rem;border-radius:.5rem;margin:.5rem 0}</style></head><body><h1>FLUX Trainer Report</h1><p>Data: ${new Date().toLocaleDateString('pl')}</p><p>Diagnostyk: ${hist.length}</p><h2>Åšrednie wyniki</h2>${areas.map((a,i)=>`<p><strong style="color:${C[a]}">${FLUX[a].name}</strong>: ${avgs[i]}/5</p><div class="bar" style="width:${avgs[i]/5*100}%;background:${C[a]}"></div>`).join('')}</body></html>`;
  const blob=new Blob([html],{type:'text/html'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='flux-trainer-report.html';a.click();URL.revokeObjectURL(url);
}

// ===== MODULE: CASE STUDIES (#4) =====
const CASE_STUDIES={
  'Decyzja cenowa pod presjÄ…':{situation:'Kierownik sprzedaÅ¼y automotive dostaje alert: konkurencja obniÅ¼yÅ‚a cenÄ™ o 12%.',context:'Q4, cele roczne niezrealizowane w 85%, centralny pricing wymaga 48h na zmianÄ™.',action:'UÅ¼yÅ‚ Decyzji 15 min: zidentyfikowaÅ‚ 3 opcje (rabat, pakiet, wartoÅ›Ä‡ dodana), wybraÅ‚ pakiet z serwisem VIP w 2h.',result:'ZamknÄ…Å‚ deal w 24h, marÅ¼a -3% ale retencja klienta +100%. Centrala zatwierdziÅ‚a post-factum.',debrief:['Co by siÄ™ staÅ‚o gdyby czekaÅ‚ na centralÄ™?','Jakie "good enough" kryteria zastosowaÅ‚?','Jak udokumentowaÄ‡ tÄ™ decyzjÄ™ dla przyszÅ‚ych case\'Ã³w?']},
  'BezpieczeÅ„stwo psychologiczne w IT':{situation:'Junior developer odkryÅ‚ krytyczny bug w kodzie tech leada, ale boi siÄ™ zgÅ‚osiÄ‡.',context:'Ostatni dev ktÃ³ry zgÅ‚osiÅ‚ problem dostaÅ‚ publicznÄ… krytykÄ™ na standup. ZespÃ³Å‚ 12 osÃ³b.',action:'WdroÅ¼ono PS Radar (anonimowy). Wynik: 2.1/5. Team lead przeszedÅ‚ coaching na feedbacku. Wprowadzono "Bug Bounty wewnÄ™trzny".',result:'PS wzrosÅ‚o do 3.8/5 po kwartale. Liczba zgÅ‚oszonych bugÃ³w x3. Time-to-fix spadÅ‚ o 40%.',debrief:['Dlaczego anonimowoÅ›Ä‡ byÅ‚a kluczowa w pierwszym kroku?','Jak mierzyÄ‡ PS bez ankiet?','Co zmieniÄ‡ jeÅ›li lider nie chce coachingu?']},
  'WdroÅ¼enie AI w zespole sprzedaÅ¼y':{situation:'Handlowcy FMCG (30 osÃ³b) bojÄ… siÄ™ AI â€” "zastÄ…pi nas", "to zabawka".',context:'Firma kupiÅ‚a licencje ChatGPT Enterprise. Po miesiÄ…cu: 3 osoby uÅ¼ywajÄ…, reszta ignoruje.',action:'AI Prompt Pack: 5 gotowych promptÃ³w (podsumowanie spotkania, follow-up mail, analiza CRM). Warsztat 2h: pokaz live efektu WOW.',result:'Adopcja po 6 tyg: 73%. Åšredni czas na follow-up z 24h do 2h. NPS wewnÄ™trzny szkolenia: 9.2.',debrief:['Dlaczego "pokaÅ¼, nie mÃ³w" zadziaÅ‚aÅ‚o lepiej?','Jak dobraÄ‡ prompty do konkretnej roli?','Co z osobami ktÃ³re nadal nie adoptujÄ…?']},
  'Test nowego formatu szkolenia':{situation:'Trener testuje 4Ã—2h online vs 1Ã—8h offline â€” ktÃ³ry format lepszy?',context:'BudÅ¼et na 2 grupy pilotaÅ¼owe. Temat: komunikacja w zespole. Grupy po 16 osÃ³b.',action:'Hypothesis Builder: "4Ã—2h â†’ NPS>8 i retencja wiedzy po 30d >60%". Pre/post test. Dziennik stosowania.',result:'4Ã—2h: NPS 8.4, retencja 67%. 8h offline: NPS 7.9, retencja 52%. Ale engagement offline wyÅ¼szy.',debrief:['Czy NPS to wystarczajÄ…ca metryka?','Jak zmierzyÄ‡ transfer do praktyki?','Jakie inne formaty warto testowaÄ‡?']}
};

// ===== MODULE: EVIDENCE MAP (#5) =====
const EVIDENCE_MAP={
  'Decyzja cenowa pod presjÄ…':{research:0,tier:2},
  'Priorytety backlogu w sprincie':{research:1,tier:2},
  'BezpieczeÅ„stwo psychologiczne w IT':{research:3,tier:1},
  'Feedback miÄ™dzy agentami':{research:4,tier:1},
  'Trudna rozmowa z partnerem':{research:4,tier:1},
  'WdroÅ¼enie AI w zespole sprzedaÅ¼y':{research:8,tier:1},
  'Test nowego formatu szkolenia':{research:10,tier:2},
  'Stare nawyki Å¼ywieniowe':{research:9,tier:1}
};
const EVIDENCE_TIERS={1:'â˜…â˜…â˜… Meta-analiza',2:'â˜…â˜… Empiryczne',3:'â˜… Eksperckie'};

// ===== MODULE: FRAMEWORKS (#7) =====
const FRAMEWORKS={
  'NVC':{name:'Nonviolent Communication',steps:['Obserwacja (fakty, nie oceny)','Uczucia (co czujÄ™?)','Potrzeby (czego potrzebujÄ™?)','ProÅ›ba (konkretna, wykonalna)'],contexts:['husband','father','professional','leader']},
  'STOP':{name:'STOP â†’ THINK â†’ ACT',steps:['STOP â€” zatrzymaj automatycznÄ… reakcjÄ™','THINK â€” jaki jest mÃ³j cel? jakie opcje?','ACT â€” wybierz najlepszÄ… opcjÄ™ i dziaÅ‚aj'],contexts:['fast','crisis','health','father']},
  'Atomic':{name:'Atomic Habits (Clear)',steps:['1% lepiej codziennie','Stack na istniejÄ…cym nawyku','Åšrodowisko > motywacja','ToÅ¼samoÅ›Ä‡ > wyniki'],contexts:['health','finance','learner','hobby']},
  '52Notatki':{name:'52 Notatki (Gerschmann)',steps:['SystematycznoÅ›Ä‡ > kwota','Automatyczny przelew co miesiÄ…c','3 sÅ‚oiki: bezpieczeÅ„stwo/wzrost/wolnoÅ›Ä‡','Edukacja finansowa co tydzieÅ„'],contexts:['finance']}
};

// ===== MODULE: EXERCISES (#8) =====
const EXERCISES=[
  {id:'eq1',area:'fast',type:'quiz',q:'ZespÃ³Å‚ czeka na peÅ‚ne dane od 3 tygodni. Co robisz?',opts:['Czekam dalej â€” dane sÄ… kluczowe','PodejmujÄ™ decyzjÄ™ z tym co mam','OrganizujÄ™ jeszcze jedno spotkanie','DelegujÄ™ decyzjÄ™ w gÃ³rÄ™'],correct:1,feedback:'Decyzja z 80% danych > perfekcyjna za 3 tygodnie. Eisenhardt 1989: szybkie zespoÅ‚y zbierajÄ… WIÄ˜CEJ info ale decydujÄ… SZYBCIEJ.'},
  {id:'eq2',area:'fast',type:'quiz',q:'Jaki jest najwiÄ™kszy wrÃ³g szybkich decyzji?',opts:['Brak danych','ParaliÅ¼ analityczny','ZÅ‚y lider','Brak budÅ¼etu'],correct:1,feedback:'ParaliÅ¼ analityczny â€” czekanie na "idealne" dane. FAST = good enough + action + learn.'},
  {id:'lq1',area:'liquid',type:'quiz',q:'Co jest fundamentem Psychological Safety wg Edmondson?',opts:['Brak konfliktÃ³w','Prawo do bÅ‚Ä™du bez konsekwencji','MiÅ‚e relacje w zespole','AnonimowoÅ›Ä‡ feedbacku'],correct:1,feedback:'PS = ludzie czujÄ… siÄ™ bezpiecznie podejmujÄ…c ryzyko interpersonalne. Nie chodzi o "bycie miÅ‚ym" ale o prawo do bÅ‚Ä™du.'},
  {id:'lq2',area:'liquid',type:'quiz',q:'Jak najszybciej poprawiÄ‡ przepÅ‚yw wiedzy w zespole?',opts:['WiÄ™cej spotkaÅ„','Collaboration Flow Map','Nowe narzÄ™dzie IT','Zmiana lidera'],correct:1,feedback:'Collaboration Flow Map identyfikuje bottlenecki. NarzÄ™dzie IT bez mapy procesÃ³w = chaos z nowym narzÄ™dziem.'},
  {id:'uq1',area:'unlearn',type:'quiz',q:'Co oznacza "unlearn" w kontekÅ›cie FLUX?',opts:['ZapomnieÄ‡ wszystko','Åšwiadomie porzuciÄ‡ przestarzaÅ‚e modele','UczyÄ‡ siÄ™ od nowa','IgnorowaÄ‡ doÅ›wiadczenie'],correct:1,feedback:'Unlearn = Å›wiadome porzucanie. Nie "zapomnieÄ‡" ale "zdecydowaÄ‡ Å¼e X juÅ¼ nie dziaÅ‚a i wybraÄ‡ Y".'},
  {id:'uq2',area:'unlearn',type:'quiz',q:'Brynjolfsson 2023 (NBER) â€” kto zyskaÅ‚ NAJWIÄ˜CEJ na AI?',opts:['Eksperci','PoczÄ…tkujÄ…cy pracownicy','Managerowie','ProgramiÅ›ci'],correct:1,feedback:'+14% produktywnoÅ›Ä‡, ale NAJWIÄ˜KSZY zysk dla najmniej doÅ›wiadczonych. AI = equalizer.'},
  {id:'xq1',area:'experiment',type:'quiz',q:'Co jest kluczowe w kulturze eksperymentÃ³w?',opts:['DuÅ¼y budÅ¼et na R&D','Traktowanie bÅ‚Ä™du jako ÅºrÃ³dÅ‚a danych','Zatrudnienie innowatorÃ³w','Osobny dziaÅ‚ innowacji'],correct:1,feedback:'van Dyck 2005: kultura zarzÄ…dzania bÅ‚Ä™dami (nie unikania!) â†’ lepsza wydajnoÅ›Ä‡. BÅ‚Ä…d = data point.'},
  {id:'xq2',area:'experiment',type:'quiz',q:'Jak poprawnie sformuÅ‚owaÄ‡ hipotezÄ™ eksperymentu?',opts:['"Sprawdzimy nowy proces"','"JeÅ›li X to Y poniewaÅ¼ Z"','"Zrobimy pilot i zobaczymy"','"Nowy sposÃ³b bÄ™dzie lepszy"'],correct:1,feedback:'Hypothesis Builder: JeÅ›li [interwencja] to [wynik] poniewaÅ¼ [mechanizm]. Metryka + timeline.'}
];

function renderExercise(exId){
  const ex=EXERCISES.find(e=>e.id===exId);if(!ex)return'';
  const c=CC[ex.area];
  return`<div class="bg-dark-900 rounded-xl p-5 border border-dark-700 mb-3" id="ex-${ex.id}">
    <div class="flex items-center gap-2 mb-3"><span class="text-sm px-2 py-0.5 rounded-full ${c.bg} ${c.t} font-bold">${FLUX[ex.area].letter}</span><span class="text-xs text-slate-500">Quiz</span></div>
    <p class="text-sm font-medium text-slate-200 mb-3">${ex.q}</p>
    <div class="space-y-2">${ex.opts.map((o,i)=>`<button onclick="checkExercise('${ex.id}',${i})" class="ex-opt w-full text-left bg-dark-950 border border-dark-700 rounded-lg px-4 py-2.5 text-sm text-slate-300 hover:border-amber-500 transition-all">${o}</button>`).join('')}</div>
    <div id="ex-feedback-${ex.id}" class="hidden mt-3 p-3 rounded-lg text-sm"></div></div>`;
}

function checkExercise(exId,chosen){
  const ex=EXERCISES.find(e=>e.id===exId);if(!ex)return;
  const fb=document.getElementById('ex-feedback-'+exId);
  const correct=chosen===ex.correct;
  fb.className='mt-3 p-3 rounded-lg text-sm '+(correct?'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20':'bg-red-500/10 text-red-400 border border-red-500/20');
  fb.innerHTML=(correct?'âœ“ DokÅ‚adnie! ':'âœ• Nie tym razem. ')+ex.feedback;
  // Highlight correct
  const btns=document.querySelectorAll(`#ex-${exId} .ex-opt`);
  btns.forEach((b,i)=>{b.disabled=true;if(i===ex.correct)b.classList.add('border-emerald-500','text-emerald-400');else if(i===chosen&&!correct)b.classList.add('border-red-500','text-red-400')});
  if(isModuleOn('progress')){const p=getProgress();p.exercises=(p.exercises||0)+1;saveProgress(p);updateProgressBar()}
}

// ===== MODULE: ANTIPATTERNS DETECTOR (#6) =====
function updateAntiDetector(area){
  const checks=document.querySelectorAll(`#detail-content input[type="checkbox"]`);
  const checked=Array.from(checks).filter(c=>c.checked).length;
  const rec=document.getElementById('anti-recommendations');if(!rec)return;
  if(checked===0){rec.innerHTML='';return}
  const tools=TOOLS.filter(t=>t.area===area);
  rec.innerHTML=`<div class="bg-amber-500/10 border border-amber-500/20 rounded-lg p-3 mt-3"><p class="text-sm text-amber-400 font-medium">${checked}/${checks.length} antywzorcÃ³w zaznaczonych</p><p class="text-xs text-slate-400 mt-1">Rekomendowane narzÄ™dzia:</p><div class="flex flex-wrap gap-1 mt-2">${tools.slice(0,3).map(t=>`<span class="text-xs px-2 py-1 rounded-full bg-dark-950 text-amber-400 border border-amber-500/20">${t.name}</span>`).join('')}</div></div>`;
}

// ===== MODULE: CANVASES (#9) =====
function downloadCanvas(toolIdx){
  const t=TOOLS[toolIdx];if(!t)return;
  const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${t.name} â€” FLUX Canvas</title>
<style>*{font-family:Inter,sans-serif;box-sizing:border-box}body{max-width:800px;margin:auto;padding:2rem}h1{color:#f59e0b;border-bottom:3px solid #f59e0b;padding-bottom:.5rem}
.field{border:2px solid #e2e8f0;border-radius:8px;padding:1.5rem;margin:1rem 0;min-height:120px}.label{font-weight:700;margin-bottom:.5rem;color:#334155}
@media print{body{padding:1cm}.field{page-break-inside:avoid}}</style></head>
<body><h1>${t.name}</h1><p style="color:#64748b">${t.type} â€” Model FLUX / ${FLUX[t.area].name}</p>
<div class="field"><div class="label">Opis</div><p>${t.desc}</p></div>
<div class="field"><div class="label">Kiedy stosowaÄ‡</div><p>${t.use}</p></div>
<div class="field"><div class="label">Notatki / Obserwacje</div><p style="color:#94a3b8;font-style:italic">Twoje notatki...</p></div>
<div class="field"><div class="label">Action Items</div><p style="color:#94a3b8;font-style:italic">1.<br>2.<br>3.</p></div>
<p style="color:#94a3b8;font-size:12px;margin-top:2rem">Wygenerowano z FLUX App | ${new Date().toLocaleDateString('pl')}</p></body></html>`;
  const blob=new Blob([html],{type:'text/html'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=t.name.toLowerCase().replace(/\s+/g,'-')+'-canvas.html';a.click();URL.revokeObjectURL(url);
}

// ===== INIT =====
document.addEventListener('DOMContentLoaded',()=>{
  initFilterChips();
  // Restore projector mode
  if(localStorage.getItem('flux_projector')==='1'){document.documentElement.classList.add('projector');document.querySelector('.projector-btn')?.classList.add('on')}
  // Apply modules (renders nav, shows/hides elements)
  applyModules();
  // Render trend dots on home wheel
  renderWheelTrendDots();
  // Wheel tooltip hover events
  document.querySelectorAll('.flux-quadrant').forEach(g=>{
    const m=g.getAttribute('onclick')?.match(/showDetail\('(\w+)'\)/);
    if(m){
      g.addEventListener('mouseenter',()=>showWheelTooltip(m[1]));
      g.addEventListener('mouseleave',()=>hideWheelTooltip());
    }
  });
  const ttEl=document.getElementById('flux-tooltip');
  if(ttEl){ttEl.addEventListener('mouseenter',keepWheelTooltip);ttEl.addEventListener('mouseleave',hideWheelTooltip);}
  // Add red border temporarily for debug (remove later)
  //if(ttEl)ttEl.style.border='2px solid red';
});
</script>
</body>
</html>